# TicketFlow
<img width="447" height="178" alt="image" src="https://github.com/user-attachments/assets/f8fa221f-8a3b-4f19-8805-7c027d346d2a" />


TicketFlow — это современная система онлайн-продажи и проверки билетов для мероприятий.

## Описание

TicketFlow позволяет организаторам создавать мероприятия, продавать билеты, а пользователям — покупать их, хранить в личном кабинете и предъявлять на входе. Для контроля доступа реализован сканер QR-кодов, который работает прямо в браузере. Локальная версия веб-приложения работает на HTTPS, что позволяет использовать дополнительные возможности. Сертификаты на [https://localhost:3000](http://localhost:3000) есть в корневой папке проекта.

## Основные функции

- **Регистрация и авторизация пользователей**
- **Роли:** обычный пользователь, администратор
- **Создание и редактирование мероприятий** (админы)
- **Покупка билетов** с выбором количества и мест (если рассадка зарезервирована)
- **Генерация уникальных QR-кодов** для каждого билета
- **Просмотр и управление своими билетами** в личном кабинете
- **Печать билетов и скачивание в PDF**
- **Панель администратора** для управления пользователями и мероприятиями
- **Сканирование QR-кодов** для проверки билетов на входе (работает на ПК и мобильных устройствах)
- **Уведомления о статусе операций** (покупка, ошибки, успехи)
- **Безопасная работа с JWT-токенами** для авторизации API
- **Использование СУБД Mongo** упрощенного контроля и оптимизации работы с БД.

## Технологии

- **Backend:** Node.js, Express, MongoDB, Mongoose, JWT, Multer, QRCode
- **Frontend:** HTML, CSS, JavaScript (Vanilla), jsQR, html2canvas, jsPDF
- **Аутентификация:** JWT (токен хранится в localStorage)
- **Генерация QR-кодов:** библиотека qrcode
- **Печать и PDF:** html2canvas, jsPDF

## Как запустить
1. Для локального запуска проекта вам необходимо скачать Node.js с официального сайта. MongoDB Compass MongoDB Community Server.

2. Установите зависимости( **НАЛИЧИЕ -PACKAGE.JSON- ОБЯЗАТЕЛЬНА. БЕЗ НИХ ЗАПУСК НЕВОЗМОЖЕН!** ):
    ```sh
    npm install
    ```
3. Запустите сервер:
    ```sh
    node server.js
    ```
4. Откройте [http://localhost:3000](http://localhost:3000) в браузере.

## Структура проекта

- `/client` — фронтенд (HTML, CSS, JS)
- `/css` — содержание файлов каскадных таблиц стилей(CSS)
- `modal.css` — стили для модальных окон
- `print-page.css` — стили для страницы печати билетов и скачивания
- `style.css` — основные стили всего веб-приложения
- **|**
- **|**
- `/js` — папка JavaScript'ов всей фронтенд зоны веб-приложения.
- `admin.js` — администирование и манипуляции в условиях веб-приложения
- `auth-simple.js` — упрощенный алгоритм аутентификации (на случай если JWT-токен потеряется из-за непредвиденного сбоя localStorage)
- `auth.js` — основной алгоритм аутентификации через JWT-токен
- `events.js` — сценарий, в котором описаны функции создания, получения, удаления, редактирования мероприятий
- `main.js` — основной сценарий, который используется на главной странице. В ней также заключены важные функции веб-приложения
- `notifications.js` — сценарий с уведомелениями, который можно заметить на главной странице
- `profile.js` — сценарий с личным профилем пользователя(редактирование, удаление, регистрация нового профиля)
- `tickets.js` — сценарий с манипуляциями над билетами. Создание, редактирование, удаление.
- **|**
- **|**
- `/qr-codes` — каталог с сохраненными QR-кодами билетов
- **|**
- **|**
- `admin-error.html` — redirect-страница, которая будет вызвана при ошибке получения доступа к администрированию.
- `admin.html` — страница с панелью администратора. Удаление мероприятий, создание, редактирование статуса билета. Статистика(билеты, пользователи, мероприятие, псевдобугхалтерия)
- `index.html` — основная страница веб-приложения, в ней распологаются все доступные мероприятия, и доступ к покупке билетов на них
- `my-tickets.html` — страница открываемая через `header` главной страницы в `dropdown` меню пользователя. В ней собраны все купленные билеты пользователя
- `payment-status.html` — В локальных запусках не имеет никакого функционала, поскольку эта страница предназначена для проведения реальных платежей через эквайрнг-системы(Stripe, и прочее)
- `profile.html` — страница с просмотром личного профиля. В ней также можно сменить данные и удалить аккаунт
- `qr-scanner.html` — страница с возможностью сканировать QR-код билета. Помимо сканирования такого кода есть альтернатива: тектовое поле с вводом уникального 6-и значного кода билета. Приоритетно должен использоваться QR-код. Обычный пользователь может получить доступ к самому сайту, но к функционалу(сканирование, поиск билета по уникальному коду) доступ ограничен. Полный доступ возможен только у администраторов
- `ticket-purchase.html` — страница с покупкой билета на мепроприятие. В ней можно скачать билет, указать место по визуализированной схеме зала и выбрать количество билетов
- **|**
- **|**
- `/node_modules` — зависимости Node.js
- **|**
- **|**
- `/server` — серверная логика, модели, роуты
- `/config` — файлы предустановок
- `database.js` — инициализация и подключение к БД
- `passport.js` — инициализация и подключение к OAuth Google. В локальном запуске не работает
- **|**
- **|**
- `/models` — каталог моделей веб-приложения
- `Event.js` — основной манипулятор над мероприятиями
- `User.js` — основной манипулятор данными пользователей
- **|**
- **|**
- `/routes` — маршруты для перенаправления на другие страницы со стороны сервера.(В будущем будут переделаны и реализованы в server-side режиме.)
- `auth.js` — тот же `auth.js` из `/client` только в server-side режиме
- `events.js` — тот же `auth.js` из `/client` только в server-side режиме
- **|**
- **|**
- `.env` — конфигурация сервера в условиях виртуальной среды
- `amvera.yaml/yaml` — deploy-конфигуратор в сервера Amvera(не работает)
- `package.json` — основные данные о веб-приложении и зависимостях
- `server.crt` — OpenSSL HTTPS сертификат на SHA-256 для работы на локальном сервере с протоколом HTTPS
- `server.js` — основной файл запуска сервера
- `server.crt` — авторизационный ключ для `server.crt`. Без него сертификат `server.crt` не будет действовать, как и веб-приложение при её запуске.

## Задача проекта

TicketFlow предназначен для автоматизации продажи билетов и контроля доступа на любые мероприятия: концерты, конференции, выставки, спортивные события и др.  
Система облегчает работу организаторов и делает покупку билетов удобной для пользователей.

---


**Разработчик:** Арсений Цой (selfiction)
        
**Лицензия:** MIT
