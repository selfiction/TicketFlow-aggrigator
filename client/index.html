<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TicketFlow - Платформа продажи билетов</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Notification Container -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo" id="homeLink">Uebok<span>Sosal?</span></div>
                <nav>
                    <ul>
                        <li><a href="#" data-page="events">Все мероприятия</a></li>
                        <li><a href="#" data-page="my-events">Мои мероприятия</a></li>
                    </ul>
                </nav>
                <div class="header-buttons">
                    <button class="scan-qr-btn" id="scanQrBtn" style="display: none;" onclick="window.location.href='/scan-qr'">
    <i class="fas fa-qrcode"></i> Сканировать QR
</button>
                    <button class="create-event-btn" id="createEventBtn">Создать мероприятие</button>
                    <div class="auth-buttons" id="authButtons">
                        <button class="login-btn" id="openLogin">Войти</button>
                        <button class="register-btn" id="openRegister">Регистрация</button>
                    </div>
                    <div class="user-menu" id="userMenu" style="display: none;">
                        <div class="user-avatar" id="userAvatar">U</div>
                        <span id="userName">Пользователь</span>
                        <div class="user-dropdown" id="userDropdown">
                            <div class="user-info">
                                <span id="dropdownName">Пользователь</span>
                                <span class="user-role" id="dropdownRole">Пользователь</span>
                            </div>
                            <a href="#" data-page="profile" onclick="window.location.href='/profile'"><i class="fas fa-user"></i> Профиль</a>
                            <a href="#" id="my-tickets" data-page="my-tickets" onclick="window.location.href='/my-tickets'"><i class="fas fa-ticket-alt"></i> Мои билеты</a>
                            <!-- В index.html обновляем кнопку админ панели -->
<a href="#admin" class="admin-link" id="adminLink" style="display: none;">
    <i class="fas fa-cog"></i> Панель администратора
</a>
                            <a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Выйти</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Home Page -->
        <div id="home-page" class="page-content active">
            <!-- Hero Section -->
            <section class="hero">
                <div class="container">
                    <h1>Найдите билеты на ваше любимое мероприятие</h1>
                    <p>Концерты, спортивные события, театральные постановки и многое другое в одном месте</p>
                </div>
            </section>

            

            <!-- Popular Events -->
            <section class="container">
                <!-- <h2 class="section-title">Доступные мероприятия</h2><-- Убрали заголовок -->
                <div class="events-grid" id="eventsGrid">
                    <!-- Event cards will be loaded here -->
                </div>
            </section>
        </div>

        <!-- Create Event Page -->
        <div id="create-event-page" class="page-content">
            <div class="container">
                <h2 class="section-title">Создание мероприятия</h2>
                <form id="create-event-form" class="create-event-form">
                    <div class="form-section">
                        <h3 class="form-section-title">Основная информация</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="event-title">Название мероприятия</label>
                                <input type="text" id="event-title" required placeholder="Введите название мероприятия">
                            </div>
                            <div class="form-group">
                                <label for="event-category">Категория</label>
                                <select id="event-category" required>
                                    <option value="">Выберите категорию</option>
                                    <option value="concert">Концерт</option>
                                    <option value="theater">Театр</option>
                                    <option value="sport">Спорт</option>
                                    <option value="exhibition">Выставка</option>
                                    <option value="conference">Конференция</option>
                                    <option value="festival">Фестиваль</option>
                                    <option value="other">Другое</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="event-description">Описание мероприятия</label>
                            <textarea id="event-description" required placeholder="Подробно опишите ваше мероприятие"></textarea>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3 class="form-section-title">Дата и время</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="event-date">Дата мероприятия</label>
                                <input type="date" id="event-date" required>
                            </div>
                            <div class="form-group">
                                <label for="event-time">Время начала</label>
                                <input type="time" id="event-time" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="event-end-time">Время окончания (необязательно)</label>
                            <input type="time" id="event-end-time">
                        </div>
                    </div>

                    <div class="form-section">
                        <h3 class="form-section-title">Местоположение</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="event-venue">Место проведения</label>
                                <input type="text" id="event-venue" required placeholder="Например, Концертный зал 'Крокус'">
                            </div>
                            <div class="form-group">
                                <label for="event-address">Адрес</label>
                                <input type="text" id="event-address" required placeholder="Полный адрес места проведения">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="event-city">Город</label>
                                <input type="text" id="event-city" required placeholder="Город">
                            </div>
                            <div class="form-group">
                                <label for="event-country">Страна</label>
                                <input type="text" id="event-country" required placeholder="Страна" value="Россия">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3 class="form-section-title">Билеты</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="event-price">Цена билета (тг.)</label>
                                <input type="number" id="event-price" min="0" required placeholder="0">
                            </div>
                            <div class="form-group">
                                <label for="event-capacity">Количество билетов</label>
                                <input type="number" id="event-capacity" min="1" required placeholder="100">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3 class="form-section-title">Изображение</h3>
                        <div class="form-group">
                            <label for="event-image">Ссылка на изображение</label>
                            <input type="url" id="event-image" placeholder="https://example.com/image.jpg">
                        </div>
                    </div>
                    <!-- Конструктор посадочных мест -->
<div class="form-section">
  <h3 class="form-section-title">Конфигурация посадочных мест</h3>
  
  <div class="seating-constructor">
    <div class="constructor-header">
      <div class="form-group">
        <label>
          <input type="checkbox" id="enableSeating"> Включить конфигуратор посадочных мест
        </label>
      </div>
    </div>
    
    <div id="seatingConfigContent" style="display: none;">
      <div class="constructor-tabs">
        <div class="constructor-tab active" data-tab="free">Свободная рассадка</div>
        <div class="constructor-tab" data-tab="reserved">Reserved Seating</div>
      </div>
      
      <div class="constructor-content active" id="freeSeatingContent">
        <div class="free-seating-config">
  <div class="form-group">
    <label for="totalRows">Количество рядов</label>
    <input type="number" id="totalRows" min="1" max="50" value="5" 
           oninput="updateHallVisualization()">
  </div>
  
  <div class="form-group">
    <label for="seatsPerRow">Мест в ряду</label>
    <input type="number" id="seatsPerRow" min="1" max="100" value="10" 
           oninput="updateHallVisualization()">
  </div>
</div>
        
        <div class="hall-visualization">
          <div class="hall-stage">СЦЕНА</div>
          <div id="freeHallLayout" class="hall-layout"></div>
          <div class="seat-info">
            Всего мест: <span id="totalSeats">50</span>
          </div>
        </div>
      </div>
      
      <div class="constructor-content" id="reservedSeatingContent">
        <div class="reserved-seating-config">
          <button type="button" class="btn-primary" onclick="addNewSection()">
  <i class="fas fa-plus"></i> Добавить сектор
</button>
          
          <div id="sectionsList" class="section-list"></div>
          
          <div class="hall-visualization">
            <div class="hall-stage">СЦЕНА</div>
            <div id="reservedHallLayout" class="hall-layout"></div>
            <div class="seat-info">
              Всего мест: <span id="reservedTotalSeats">0</span> | 
              Секторов: <span id="totalSections">0</span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="constructor-actions">
        <button class="btn-primary" onclick="applySeatingConfig()">
          Применить конфигурацию
        </button>
        <button class="btn-secondary" onclick="resetSeatingConfig()">
          Сбросить
        </button>
      </div>
    </div>
  </div>
</div>
<!-- Модальное окно редактирования сектора -->
<div id="sectionModal" class="modal-overlay" style="display: none;">
  <div class="auth-modal" style="max-width: 500px;">
    <div class="modal-header">
      <h2>Редактирование сектора</h2>
     <button type="button" class="close-modal" onclick="closeSectionModal(event)">
    &times;
</button>
    </div>
    <div class="modal-body">
      <form id="sectionForm" class="modal-form active">
        <div class="form-input">
          <label for="sectionName">Название сектора</label>
          <input type="text" id="sectionName" required placeholder="Например: Партер, Ложа, Балкон">
        </div>
        
        <div class="form-row">
          <div class="form-input">
            <label for="sectionRows">Количество рядов</label>
            <input type="number" id="sectionRows" min="1" max="50" required value="5">
          </div>
          <div class="form-input">
            <label for="sectionSeats">Мест в ряду</label>
            <input type="number" id="sectionSeats" min="1" max="100" required value="10">
          </div>
        </div>
        
        <div class="form-input">
          <label for="sectionPrice">Цена билета (руб.)</label>
          <input type="number" id="sectionPrice" min="0" required value="1000">
        </div>
        
        <div class="form-input">
          <label for="sectionColor">Цвет сектора</label>
          <div class="color-picker-container">
            <input type="color" id="sectionColor" value="#3a86ff">
            <div class="color-presets">
  <div class="color-preset" style="background: #3a86ff" data-color="#3a86ff" onclick="selectColorPreset(this, '#3a86ff')"></div>
  <div class="color-preset" style="background: #ff006e" data-color="#ff006e" onclick="selectColorPreset(this, '#ff006e')"></div>
  <div class="color-preset" style="background: #8338ec" data-color="#8338ec" onclick="selectColorPreset(this, '#8338ec')"></div>
  <div class="color-preset" style="background: #fb5607" data-color="#fb5607" onclick="selectColorPreset(this, '#fb5607')"></div>
  <div class="color-preset" style="background: #ffbe0b" data-color="#ffbe0b" onclick="selectColorPreset(this, '#ffbe0b')"></div>
  <div class="color-preset" style="background: #4caf50" data-color="#4caf50" onclick="selectColorPreset(this, '#4caf50')"></div>
</div>
          </div>
        </div>
        
        <div class="form-actions">
          <button type="button" class="modal-submit" onclick="saveSection()">
            Сохранить сектор
          </button>
          <button type="button" class="btn-secondary" onclick="closeSectionModal()">
            Отмена
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

                    <button type="submit" class="submit-btn">Создать мероприятие</button>
                </form>
            </div>
        </div>

        <!-- Login Modal -->
        <div class="modal-overlay" id="loginModal">
            <div class="auth-modal">
                <div class="modal-header">
                    <h2>Вход в аккаунт</h2>
                    <button class="close-modal" id="closeLogin">&times;</button>
                </div>
                <div class="modal-tabs">
                    <div class="modal-tab" data-tab="login">Вход</div>
                    <div class="modal-tab" data-tab="register">Регистрация</div>
                </div>
                <div class="modal-body">
                    <form class="modal-form active" id="loginForm">
                        <div class="form-input">
                            <label for="loginEmail">Email</label>
                            <input type="email" id="loginEmail" placeholder="Введите ваш email" required>
                        </div>
                        <div class="form-input">
                            <label for="loginPassword">Пароль</label>
                            <input type="password" id="loginPassword" placeholder="Введите ваш пароль" required>
                        </div>
                        <button type="submit" class="modal-submit">Войти</button>
                        <div class="form-footer">
                            Нет аккаунта? <a href="#" id="switchToRegister">Зарегистрироваться</a>
                        </div>
                    </form>
                    
                    <form class="modal-form" id="registerForm">
                        <div class="form-input">
                            <label for="registerName">Имя</label>
                            <input type="text" id="registerName" placeholder="Введите ваше имя" required>
                        </div>
                        <div class="form-input">
                            <label for="registerEmail">Email</label>
                            <input type="email" id="registerEmail" placeholder="Введите ваш email" required>
                        </div>
                        <div class="form-input">
                            <label for="registerPassword">Пароль</label>
                            <input type="password" id="registerPassword" placeholder="Придумайте пароль" required>
                        </div>
                        <div class="form-input">
                            <label for="registerConfirm">Подтверждение пароля</label>
                            <input type="password" id="registerConfirm" placeholder="Повторите пароль" required>
                        </div>
                        <div class="admin-checkbox">
                            <input type="checkbox" id="registerAdmin">
                            <label for="registerAdmin">Регистрация как администратор</label>
                        </div>
                        <button type="submit" class="modal-submit">Зарегистрироваться</button>
                        <div class="form-footer">
                            Уже есть аккаунт? <a href="#" id="switchToLogin">Войти</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>О нас</h3>
                    <ul>
                        <li><a href="#">О компании</a></li>
                        <li><a href="#">Контакты</a></li>
                        <li><a href="#">Партнеры</a></li>
                        <li><a href="#">Рекламодателям</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Помощь</h3>
                    <ul>
                        <li><a href="#">Как купить билет</a></li>
                        <li><a href="#">Вопросы и ответы</a></li>
                        <li><a href="#">Правила использования</a></li>
                        <li><a href="#">Политика конфиденциальности</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Контакты</h3>
                    <ul>
                        <li>Телефон: +7 (775) 069-069-6592</li>
                        <li>Email: info@ticketflow.ru</li>
                        <li>Адрес: Актобе, Абулхаир Хана 16</li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>Подписка</h3>
                    <p>Подпишитесь на рассылку, чтобы получать информацию о новых мероприятиях и акциях</p>
                    <form>
                        <input type="email" placeholder="Ваш email" style="padding: 10px; width: 100%; margin: 10px 0; border-radius: 4px; border: none;">
                        <button type="submit" class="search-btn" style="margin-top: 10px;">Подписаться</button>
                    </form>
                </div>
            </div>
            <div class="copyright">
                <p>© 2025 TicketFlow. Все права защищены.</p>
            </div>
        </div>
    </footer>
    <!-- Модальное окно успешной покупки -->
<div class="modal-overlay" id="purchaseSuccessModal" style="display: none;">
    <div class="purchase-modal">
        <div class="modal-header">
            <h2>✅ Покупка успешна!</h2>
            <button class="close-modal" onclick="closePurchaseModal()">&times;</button>
        </div>
        
        <div class="modal-body">
            <div class="purchase-success">
                <div class="success-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                
                <h3>Ваши билеты приобретены</h3>
                <p class="purchase-info">На вашу почту отправлено подтверждение. Билеты также доступны в личном кабинете.</p>
                
                <div class="tickets-list" id="ticketsList">
                    <!-- Сюда будут добавляться билеты -->
                </div>
                
                <div class="modal-actions">
                    <button class="btn-primary" onclick="window.location.href='/?page=my-tickets'">
                        <i class="fas fa-ticket-alt"></i> Мои билеты
                    </button>
                    <button class="btn-secondary" onclick="closePurchaseModal()">
                        <i class="fas fa-times"></i> Закрыть
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

    <script src="js/auth.js"></script>
    <script src="js/events.js"></script>
    <script src="js/notifications.js"></script>
    <script src="js/main.js"></script>
   
<script>
// Переменные для конструктора
let seatingSections = [];
let currentSeatingType = 'free';

// Инициализация конструктора
function initSeatingConstructor() {
  // Обработчики для табов
  document.querySelectorAll('.constructor-tab').forEach(tab => {
    tab.addEventListener('click', () => {
      const tabName = tab.getAttribute('data-tab');
      switchSeatingTab(tabName);
    });
  });

  // Переключение enabled/disabled
  document.getElementById('enableSeating').addEventListener('change', function() {
    document.getElementById('seatingConfigContent').style.display = 
      this.checked ? 'block' : 'none';
    if (this.checked) {
      updateHallVisualization();
    }
  });

  // Инициализация визуализации
  updateHallVisualization();
  setupSeatingInputListeners();
}

// Переключение между табами
function switchSeatingTab(tabName) {
  currentSeatingType = tabName;
  
  // Активируем нужный таб
  document.querySelectorAll('.constructor-tab').forEach(tab => {
    tab.classList.toggle('active', tab.getAttribute('data-tab') === tabName);
  });
  
  // Показываем нужный контент
  document.querySelectorAll('.constructor-content').forEach(content => {
    content.classList.toggle('active', content.id === tabName + 'SeatingContent');
  });
  
  // Обновляем визуализацию
  updateHallVisualization();
}

// Визуализация зала для свободной рассадки
function visualizeFreeSeating() {
  const container = document.getElementById('freeHallLayout');
  const rows = parseInt(document.getElementById('totalRows').value) || 5;
  const seatsPerRow = parseInt(document.getElementById('seatsPerRow').value) || 10;
  
  container.innerHTML = '';
  
  for (let row = 1; row <= rows; row++) {
    const rowDiv = document.createElement('div');
    rowDiv.className = 'hall-row';
    
    // Номер ряда
    const rowNumber = document.createElement('div');
    rowNumber.className = 'row-number';
    rowNumber.textContent = row;
    rowDiv.appendChild(rowNumber);
    
    // Места
    for (let seat = 1; seat <= seatsPerRow; seat++) {
      const seatDiv = document.createElement('div');
      seatDiv.className = 'seat free';
      seatDiv.title = `Ряд ${row}, Место ${seat}`;
      seatDiv.textContent = seat;
      rowDiv.appendChild(seatDiv);
    }
    
    container.appendChild(rowDiv);
  }
  
  // Обновляем общее количество мест
  document.getElementById('totalSeats').textContent = rows * seatsPerRow;
}

// Визуализация зала для reserved seating
function visualizeReservedSeating() {
  const container = document.getElementById('reservedHallLayout');
  container.innerHTML = '';
  
  let totalSeats = 0;
  let currentRow = 1;
  
  seatingSections.forEach((section, sectionIndex) => {
    // Заголовок секции
    const sectionHeader = document.createElement('div');
    sectionHeader.className = 'section-header';
    sectionHeader.innerHTML = `<h4>${section.name} (${section.price} руб.)</h4>`;
    container.appendChild(sectionHeader);
    
    // Места секции
    for (let row = 1; row <= section.rows; row++) {
      const rowDiv = document.createElement('div');
      rowDiv.className = 'hall-row';
      
      // Номер ряда
      const rowNumber = document.createElement('div');
      rowNumber.className = 'row-number';
      rowNumber.textContent = currentRow;
      rowDiv.appendChild(rowNumber);
      
      // Места
      for (let seat = 1; seat <= section.seatsPerRow; seat++) {
        const seatDiv = document.createElement('div');
        seatDiv.className = 'seat free';
        seatDiv.style.backgroundColor = section.color + '20';
        seatDiv.style.borderColor = section.color;
        seatDiv.title = `${section.name}, Ряд ${currentRow}, Место ${seat}`;
        seatDiv.textContent = seat;
        rowDiv.appendChild(seatDiv);
      }
      
      container.appendChild(rowDiv);
      currentRow++;
      totalSeats += section.seatsPerRow;
    }
    
    // Разделитель между секциями
    if (sectionIndex < seatingSections.length - 1) {
      const aisle = document.createElement('div');
      aisle.className = 'hall-row';
      aisle.innerHTML = '<div class="seat aisle">───────</div>';
      container.appendChild(aisle);
    }
  });
  
  // Обновляем статистику
  document.getElementById('reservedTotalSeats').textContent = totalSeats;
  document.getElementById('totalSections').textContent = seatingSections.length;
}

// Обновление визуализации
function updateHallVisualization() {
  if (currentSeatingType === 'free') {
    visualizeFreeSeating();
  } else {
    visualizeReservedSeating();
  }
}

// Добавление нового сектора
function addNewSection() {
  const newSection = {
    name: `Сектор ${seatingSections.length + 1}`,
    rows: 5,
    seatsPerRow: 10,
    price: 1000,
    color: getRandomColor()
  };
  
  seatingSections.push(newSection);
  renderSectionsList();
  updateHallVisualization();
}

// Генерация случайного цвета
function getRandomColor() {
  const colors = [
    '#3a86ff', '#ff006e', '#8338ec', '#fb5607', '#ffbe0b',
    '#4caf50', '#9c27b0', '#00bcd4', '#ff5722', '#607d8b'
  ];
  return colors[seatingSections.length % colors.length];
}

// Отображение списка секторов
function renderSectionsList() {
  const container = document.getElementById('sectionsList');
  container.innerHTML = '';
  
  seatingSections.forEach((section, index) => {
    const sectionDiv = document.createElement('div');
    sectionDiv.className = 'section-item';
    sectionDiv.style.borderLeftColor = section.color;
    
    sectionDiv.innerHTML = `
      <div class="section-header">
        <h5>${section.name}</h5>
        <div class="section-controls">
          <button class="btn-secondary" onclick="editSection(${index})">
            <i class="fas fa-edit"></i>
          </button>
          <button class="btn-danger" onclick="removeSection(${index})">
            <i class="fas fa-trash"></i>
          </button>
        </div>
      </div>
      <div class="section-info">
        Рядов: ${section.rows} | Мест в ряду: ${section.seatsPerRow} | 
        Цена: ${section.price} руб. | Всего мест: ${section.rows * section.seatsPerRow}
      </div>
    `;
    
    container.appendChild(sectionDiv);
  });
}

// Редактирование сектора
function editSection(index) {
  const section = seatingSections[index];
  
  const newName = prompt('Название сектора:', section.name);
  if (newName) section.name = newName;
  
  const newRows = parseInt(prompt('Количество рядов:', section.rows));
  if (!isNaN(newRows)) section.rows = newRows;
  
  const newSeats = parseInt(prompt('Мест в ряду:', section.seatsPerRow));
  if (!isNaN(newSeats)) section.seatsPerRow = newSeats;
  
  const newPrice = parseInt(prompt('Цена билета:', section.price));
  if (!isNaN(newPrice)) section.price = newPrice;
  
  renderSectionsList();
  updateHallVisualization();
}

// Удаление сектора
function removeSection(index) {
  if (confirm('Удалить этот сектор?')) {
    seatingSections.splice(index, 1);
    renderSectionsList();
    updateHallVisualization();
  }
}

// Применение конфигурации
function applySeatingConfig() {
  const seatingConfig = {
    type: currentSeatingType,
    rows: 0,
    seatsPerRow: 0,
    sections: []
  };
  
  if (currentSeatingType === 'free') {
    seatingConfig.rows = parseInt(document.getElementById('totalRows').value);
    seatingConfig.seatsPerRow = parseInt(document.getElementById('seatsPerRow').value);
  } else {
    seatingConfig.sections = [...seatingSections];
  }
  
  // Сохраняем конфигурацию в скрытом поле формы
  document.getElementById('seatingConfig').value = JSON.stringify(seatingConfig);
  
  alert('Конфигурация мест применена!');
}

// Сброс конфигурации
function resetSeatingConfig() {
  if (confirm('Сбросить текущую конфигурацию?')) {
    seatingSections = [];
    document.getElementById('totalRows').value = 5;
    document.getElementById('seatsPerRow').value = 10;
    renderSectionsList();
    updateHallVisualization();
  }
}

// Инициализация при загрузке
document.addEventListener('DOMContentLoaded', function() {
  initSeatingConstructor();
  
  // Добавляем скрытое поле для хранения конфигурации
  const seatingConfigInput = document.createElement('input');
  seatingConfigInput.type = 'hidden';
  seatingConfigInput.id = 'seatingConfig';
  seatingConfigInput.name = 'seatingConfig';
  document.getElementById('create-event-form').appendChild(seatingConfigInput);
});

// Переменные для управления секторами
let currentEditingSection = null;
let isEditing = false;

// Функция открытия модального окна
function openSectionModal(sectionIndex = null) {
  const modal = document.getElementById('sectionModal');
  modal.style.display = 'flex';
  
  if (sectionIndex !== null) {
    // Редактирование существующего сектора
    currentEditingSection = sectionIndex;
    isEditing = true;
    fillSectionForm(seatingSections[sectionIndex]);
    document.querySelector('.modal-header h2').textContent = 'Редактирование сектора';
  } else {
    // Создание нового сектора
    currentEditingSection = null;
    isEditing = false;
    resetSectionForm();
    document.querySelector('.modal-header h2').textContent = 'Создание сектора';
  }
}

// Функция закрытия модального окна
function closeSectionModal() {
  document.getElementById('sectionModal').style.display = 'none';
  currentEditingSection = null;
}

// Заполнение формы данными сектора
function fillSectionForm(section) {
  document.getElementById('sectionName').value = section.name;
  document.getElementById('sectionRows').value = section.rows;
  document.getElementById('sectionSeats').value = section.seatsPerRow;
  document.getElementById('sectionPrice').value = section.price;
  document.getElementById('sectionColor').value = section.color;
  
  // Активируем соответствующий preset цвета
  document.querySelectorAll('.color-preset').forEach(preset => {
    preset.classList.toggle('active', preset.dataset.color === section.color);
  });
}

// Сброс формы
function resetSectionForm() {
  document.getElementById('sectionForm').reset();
  document.getElementById('sectionColor').value = '#3a86ff';
  document.querySelectorAll('.color-preset').forEach(preset => {
    preset.classList.toggle('active', preset.dataset.color === '#3a86ff');
  });
}

// Сохранение сектора
function saveSection() {
  const name = document.getElementById('sectionName').value.trim();
  const rows = parseInt(document.getElementById('sectionRows').value);
  const seats = parseInt(document.getElementById('sectionSeats').value);
  const price = parseInt(document.getElementById('sectionPrice').value);
  const color = document.getElementById('sectionColor').value;

  // Валидация
  if (!name) {
    alert('Введите название сектора');
    return;
  }

  if (rows < 1 || rows > 50) {
    alert('Количество рядов должно быть от 1 до 50');
    return;
  }

  if (seats < 1 || seats > 100) {
    alert('Количество мест в ряду должно быть от 1 до 100');
    return;
  }

  if (price < 0) {
    alert('Цена не может быть отрицательной');
    return;
  }

  const sectionData = {
    name: name,
    rows: rows,
    seatsPerRow: seats,
    price: price,
    color: color
  };

  if (isEditing && currentEditingSection !== null) {
    // Обновление существующего сектора
    seatingSections[currentEditingSection] = sectionData;
  } else {
    // Добавление нового сектора
    seatingSections.push(sectionData);
  }

  // Обновляем интерфейс
  renderSectionsList();
  updateHallVisualization();
  closeSectionModal();
}

// Удаление сектора
function removeSection(index) {
  if (confirm('Удалить этот сектор?')) {
    seatingSections.splice(index, 1);
    renderSectionsList();
    updateHallVisualization();
  }
}

// Обновляем рендеринг списка секторов
function renderSectionsList() {
  const container = document.getElementById('sectionsList');
  container.innerHTML = '';

  if (seatingSections.length === 0) {
    container.innerHTML = `
      <div class="no-sections">
        <i class="fas fa-chairs" style="font-size: 3rem; color: #ddd; margin-bottom: 15px;"></i>
        <h4>Секторы не добавлены</h4>
        <p>Добавьте хотя бы один сектор для reserved seating</p>
      </div>
    `;
    return;
  }

  seatingSections.forEach((section, index) => {
    const totalSeats = section.rows * section.seatsPerRow;
    const totalRevenue = totalSeats * section.price;

    const sectionDiv = document.createElement('div');
    sectionDiv.className = 'section-item';
    sectionDiv.style.borderLeftColor = section.color;

    sectionDiv.innerHTML = `
      <div class="section-header">
        <div>
          <h3 class="section-title">${section.name}</h3>
          <div class="section-price">${section.price} руб./место</div>
        </div>
        <div class="section-controls">
          <button class="btn-secondary" onclick="openSectionModal(${index})">
            <i class="fas fa-edit"></i> Изменить
          </button>
          <button class="btn-danger" onclick="removeSection(${index})">
            <i class="fas fa-trash"></i> Удалить
          </button>
        </div>
      </div>
      
      <div class="section-info">
        <div class="info-item">
          <div class="info-label">Рядов</div>
          <div class="info-value">${section.rows}</div>
        </div>
        <div class="info-item">
          <div class="info-label">Мест в ряду</div>
          <div class="info-value">${section.seatsPerRow}</div>
        </div>
        <div class="info-item">
          <div class="info-label">Всего мест</div>
          <div class="info-value">${totalSeats}</div>
        </div>
        <div class="info-item">
          <div class="info-label">Общая выручка</div>
          <div class="info-value">${totalRevenue.toLocaleString()} руб.</div>
        </div>
      </div>
      
      <div class="section-color-display">
        <div class="info-label">Цвет сектора</div>
        <div class="color-preview" style="background: ${section.color}; width: 40px; height: 20px; border-radius: 3px;"></div>
      </div>
    `;

    container.appendChild(sectionDiv);
  });
}

// Добавляем обработчики для цветовых preset'ов
function setupColorPresets() {
  document.querySelectorAll('.color-preset').forEach(preset => {
    preset.addEventListener('click', function() {
      const color = this.dataset.color;
      document.getElementById('sectionColor').value = color;
      
      // Активируем выбранный preset
      document.querySelectorAll('.color-preset').forEach(p => {
        p.classList.remove('active');
      });
      this.classList.add('active');
    });
  });
}

// Обновляем функцию добавления нового сектора
function addNewSection() {
  openSectionModal(); // Открываем модальное окно для создания
}

// Инициализация при загрузке
document.addEventListener('DOMContentLoaded', function() {
  initSeatingConstructor();
  setupColorPresets();
  
  // Закрытие модального окна по клику вне области
  document.getElementById('sectionModal').addEventListener('click', function(e) {
    if (e.target === this) {
      closeSectionModal();
    }
  });
});

// Функция выбора цветового пресета
function selectColorPreset(element, color) {
    console.log('Выбран цвет:', color);
    
    // Убираем активный класс у всех пресетов
    document.querySelectorAll('.color-preset').forEach(preset => {
        preset.classList.remove('active');
    });
    
    // Добавляем активный класс выбранному пресету
    element.classList.add('active');
    
    // Устанавливаем выбранный цвет в color picker
    document.getElementById('sectionColor').value = color;
    
    // Обновляем preview
    updateColorPreview(color);
}

// Функция обновления preview цвета
function updateColorPreview(color) {
    const preview = document.querySelector('.color-preview');
    if (preview) {
        preview.style.background = color;
    }
}

// Функция инициализации цветовых пресетов
function initColorPresets() {
    console.log('Инициализация цветовых пресетов...');
    
    // Обработчики для клика
    document.querySelectorAll('.color-preset').forEach(preset => {
        preset.addEventListener('click', function() {
            const color = this.getAttribute('data-color');
            selectColorPreset(this, color);
        });
    });
    
    // Обработчик для изменения color picker
    const colorInput = document.getElementById('sectionColor');
    if (colorInput) {
        colorInput.addEventListener('input', function() {
            updateColorPreview(this.value);
            // Снимаем выделение с пресетов при ручном выборе цвета
            document.querySelectorAll('.color-preset').forEach(preset => {
                preset.classList.remove('active');
            });
        });
    }
    
    // Активируем первый пресет по умолчанию
    const firstPreset = document.querySelector('.color-preset');
    if (firstPreset) {
        const defaultColor = firstPreset.getAttribute('data-color');
        selectColorPreset(firstPreset, defaultColor);
    }
}
// Функция для динамического изменения размера мест
function updateSeatSizes() {
    const screenWidth = window.innerWidth;
    let seatSize = 30; // размер по умолчанию для десктопа
    
    if (screenWidth < 480) {
        seatSize = 18;
    } else if (screenWidth < 768) {
        seatSize = 22;
    } else if (screenWidth < 1024) {
        seatSize = 26;
    }
    
    // Применяем размеры
    document.querySelectorAll('.seat').forEach(seat => {
        seat.style.width = seatSize + 'px';
        seat.style.height = seatSize + 'px';
        seat.style.fontSize = Math.max(8, seatSize - 12) + 'px';
    });
    
    // Обновляем размеры номеров рядов
    document.querySelectorAll('.row-number').forEach(row => {
        row.style.width = (seatSize * 0.8) + 'px';
        row.style.fontSize = Math.max(10, seatSize - 8) + 'px';
    });
}

// Вызываем при изменении размера окна
window.addEventListener('resize', debounce(() => {
    updateSeatSizes();
    updateHallVisualization();
}, 250));

// И при загрузке
document.addEventListener('DOMContentLoaded', updateSeatSizes);

</script>
</body>
</html>