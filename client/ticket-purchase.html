<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–∫—É–ø–∫–∞ –±–∏–ª–µ—Ç–∞ - TicketFlow</title>
    <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ PDF –∏ PNG -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/css/modal.css">
    <link rel="stylesheet" href="/css/print-page.css">

    <style>

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* –ü—Ä–æ—Å—Ç–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–∫ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è */
.seating-visualization-simple {
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.visualization-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    flex-wrap: wrap;
    gap: 15px;
}

.hall-stage {
    background: #333;
    color: white;
    padding: 10px 20px;
    border-radius: 5px;
    font-weight: bold;
    text-align: center;
}

.legend-simple {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 14px;
}

.color-dot {
    width: 15px;
    height: 15px;
    border-radius: 50%;
    border: 1px solid #ddd;
}

.free-dot { background: #4caf50; }
.taken-dot { background: #f44336; }
.selected-dot { background: #3a86ff; }

.simple-hall-layout {
    display: flex;
    flex-direction: column;
    gap: 8px;
    align-items: center;
    min-height: 300px;
    background: #f8f9fa;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 15px;
}

.simple-row {
    display: flex;
    gap: 4px;
    align-items: center;
}

.row-label {
    width: 30px;
    text-align: center;
    font-weight: bold;
    color: #666;
    font-size: 14px;
}

.simple-seat {
    width: 28px;
    height: 28px;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    cursor: pointer;
    border: 1px solid #ddd;
    transition: all 0.2s ease;
}

.simple-seat.free {
    background: #4caf50;
    color: white;
    border-color: #388e3c;
}

.simple-seat.free:hover {
    background: #388e3c;
    transform: scale(1.05);
}

.simple-seat.taken {
    background: #f44336;
    color: white;
    border-color: #d32f2f;
    cursor: not-allowed;
}

.simple-seat.selected {
    background: #3a86ff;
    color: white;
    border-color: #1565c0;
    transform: scale(1.05);
    box-shadow: 0 0 0 2px #ffeb3b;
}

.selection-info-simple {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    background: #e3f2fd;
    border-radius: 8px;
    border-left: 4px solid #2196f3;
}

.selection-info-simple p {
    margin: 0;
    font-weight: 500;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .visualization-header {
        flex-direction: column;
        align-items: stretch;
    }
    
    .hall-stage {
        order: -1;
    }
    
    .legend-simple {
        justify-content: center;
    }
    
    .simple-seat {
        width: 24px;
        height: 24px;
        font-size: 10px;
    }
    
    .row-label {
        width: 25px;
        font-size: 12px;
    }
    
    .selection-info-simple {
        flex-direction: column;
        gap: 10px;
        text-align: center;
    }
}
        
        /* Notification System */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .notification {
            background: white;
            border-radius: 8px;
            padding: 16px 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            max-width: 350px;
            transform: translateX(100%);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            border-left: 4px solid #3a86ff;
        }
        
        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }
        
        .notification.success {
            border-left-color: #4caf50;
        }
        
        .notification.error {
            border-left-color: #f44336;
        }
        
        .notification.warning {
            border-left-color: #ff9800;
        }
        
        .notification.info {
            border-left-color: #3a86ff;
        }
        
        .notification-icon {
            font-size: 20px;
            flex-shrink: 0;
        }
        
        .notification.success .notification-icon {
            color: #4caf50;
        }
        
        .notification.error .notification-icon {
            color: #f44336;
        }
        
        .notification.warning .notification-icon {
            color: #ff9800;
        }
        
        .notification.info .notification-icon {
            color: #3a86ff;
        }
        
        .notification-content {
            flex-grow: 1;
        }
        
        .notification-title {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .notification-message {
            font-size: 14px;
            color: #666;
        }
        
        .notification-close {
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            color: #999;
            flex-shrink: 0;
            padding: 4px;
            border-radius: 4px;
            transition: color 0.2s, background 0.2s;
        }
        
        .notification-close:hover {
            color: #666;
            background: #f5f5f5;
        }
        
        /* Header Styles */
        header {
            background-color: #fff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }
        
        .logo {
            font-size: 24px;
            font-weight: 700;
            color: #3a86ff;
            cursor: pointer;
        }
        
        .logo span {
            color: #ff006e;
        }
        
        nav ul {
            display: flex;
            list-style: none;
        }
        
        nav ul li {
            margin-left: 25px;
        }
        
        nav ul li a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            transition: color 0.3s;
        }
        
        nav ul li a:hover {
            color: #3a86ff;
        }
        
        .header-buttons {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .auth-buttons button {
            padding: 8px 16px;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .login-btn {
            background: transparent;
            border: 1px solid #3a86ff;
            color: #3a86ff;
            margin-right: 10px;
        }
        
        .register-btn {
            background: #3a86ff;
            border: 1px solid #3a86ff;
            color: #fff;
        }
        
        .create-event-btn {
            background: #ff006e;
            border: 1px solid #ff006e;
            color: #fff;
            padding: 8px 16px;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
        }
        
        .login-btn:hover {
            background: #f0f7ff;
        }
        
        .register-btn:hover {
            background: #2a75f0;
        }
        
        .create-event-btn:hover {
            background: #e00064;
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            position: relative;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #3a86ff;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            margin-right: 10px;
        }
        
        .user-dropdown {
            position: absolute;
            top: 50px;
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            width: 200px;
            padding: 10px 0;
            z-index: 1000;
            display: none;
        }
        
        .user-dropdown.show {
            display: block;
        }
        
        .user-dropdown .user-info {
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
            font-weight: 500;
        }
        
        .user-dropdown .user-role {
            display: block;
            font-size: 12px;
            color: #666;
            font-weight: normal;
        }
        
        .user-dropdown a {
            display: block;
            padding: 10px 15px;
            text-decoration: none;
            color: #333;
            transition: background 0.3s;
        }
        
        .user-dropdown a:hover {
            background: #f5f7fa;
        }
        
        .user-dropdown a i {
            margin-right: 8px;
            width: 20px;
            text-align: center;
        }
        
        .admin-link {
            color: #ff006e !important;
            font-weight: 500;
        }
        
        /* Page Content */
        .page-content {
            display: none;
            min-height: 60vh;
            padding: 30px 0;
        }
        
        .page-content.active {
            display: block;
        }
        
        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, #3a86ff 0%, #8338ec 100%);
            color: white;
            padding: 60px 0;
            text-align: center;
        }
        
        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
        }
        
        .hero p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto 30px;
        }
        
        /* Search Form */
        .search-form {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            margin: -40px auto 0;
            position: relative;
            z-index: 10;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-group {
            flex: 1;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .search-btn, .submit-btn {
            background: #ff006e;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.3s;
            width: 100%;
        }
        
        .search-btn:hover, .submit-btn:hover {
            background: #e00064;
        }
        
        /* Events Section */
        .section-title {
            text-align: center;
            margin: 50px 0 30px;
            font-size: 2rem;
            color: #333;
        }
        
        .events-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 50px;
        }
        
        .event-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }
        
        .event-card:hover {
            transform: translateY(-5px);
        }
        
        .event-image {
            height: 180px;
            background-color: #8338ec;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 500;
        }
        
        .event-details {
            padding: 20px;
        }
        
        .event-date {
            color: #3a86ff;
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .event-title {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #333;
        }
        
        .event-location {
            color: #666;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .event-price {
            font-weight: 700;
            font-size: 1.2rem;
            color: #ff006e;
            margin-bottom: 15px;
        }
        
        .book-btn {
            background: #3a86ff;
            color: white;
            border: none;
            padding: 10px 0;
            border-radius: 4px;
            width: 100%;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s;
        }
        
        .book-btn:hover {
            background: #2a75f0;
        }
        
        /* Categories Section */
        .categories {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 50px;
        }
        
        .category {
            background: white;
            padding: 15px 25px;
            border-radius: 30px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .category:hover {
            background: #3a86ff;
            color: white;
        }
        
        /* Create Event Form */
        .create-event-form {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            max-width: 800px;
            margin: 0 auto;
        }
        
        .form-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .form-section-title {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: #3a86ff;
        }
        
        /* Footer */
        footer {
            background: #2d3748;
            color: white;
            padding: 50px 0 20px;
        }
        
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .footer-column h3 {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: #3a86ff;
        }
        
        .footer-column ul {
            list-style: none;
        }
        
        .footer-column ul li {
            margin-bottom: 10px;
        }
        
        .footer-column ul li a {
            color: #cbd5e0;
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .footer-column ul li a:hover {
            color: white;
        }
        
        .copyright {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid #4a5568;
            color: #cbd5e0;
        }
        
        /* Auth Modals */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            display: none;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .auth-modal {
            background: white;
            border-radius: 10px;
            width: 100%;
            max-width: 450px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            animation: modalFadeIn 0.3s;
        }
        
        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            background: #3a86ff;
            color: white;
            padding: 20px;
            position: relative;
            text-align: center;
        }
        
        .modal-header h2 {
            font-size: 1.5rem;
        }
        
        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .modal-tabs {
            display: flex;
            border-bottom: 1px solid #eee;
        }
        
        .modal-tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .modal-tab.active {
            background: white;
            font-weight: 500;
            border-bottom: 2px solid #3a86ff;
        }
        
        .modal-body {
            padding: 25px;
        }
        
        .modal-form {
            display: none;
        }
        
        .modal-form.active {
            display: block;
        }
        
        .form-input {
            margin-bottom: 20px;
        }
        
        .form-input label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }
        
        .form-input input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        .form-input input:focus {
            border-color: #3a86ff;
            outline: none;
        }
        
        .modal-submit {
            background: #3a86ff;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 4px;
            width: 100%;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background 0.3s;
            margin-top: 10px;
        }
        
        .modal-submit:hover {
            background: #2a75f0;
        }
        
        .form-footer {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
            color: #666;
        }
        
        .form-footer a {
            color: #3a86ff;
            text-decoration: none;
        }
        
        .admin-checkbox {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .admin-checkbox input {
            margin-right: 8px;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 10px;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            nav ul {
                margin: 15px 0;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            nav ul li {
                margin: 5px 10px;
            }
            
            .header-buttons {
                margin-top: 10px;
                flex-direction: column;
                gap: 10px;
            }
            
            .hero h1 {
                font-size: 2rem;
            }
            
            .hero p {
                font-size: 1rem;
            }
            
            .auth-modal {
                width: 90%;
            }
            
            .notification {
                max-width: 300px;
            }
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –±–∏–ª–µ—Ç–æ–≤ */
.tickets-modal {
  background: white;
  border-radius: 12px;
  width: 90%;
  max-width: 600px;
  max-height: 80vh;
  overflow: hidden;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
  animation: modalSlideIn 0.3s ease;
}

@keyframes modalSlideIn {
  from {
    opacity: 0;
    transform: translateY(-50px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.modal-header {
  background: linear-gradient(135deg, #3a86ff 0%, #8338ec 100%);
  color: white;
  padding: 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.modal-header h2 {
  margin: 0;
  font-size: 1.5rem;
}

.close-modal {
  background: none;
  border: none;
  color: white;
  font-size: 1.8rem;
  cursor: pointer;
  padding: 0;
  width: 30px;
  height: 30px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: background 0.2s;
}

.close-modal:hover {
  background: rgba(255, 255, 255, 0.2);
}

.modal-body {
  padding: 20px;
  max-height: calc(80vh - 80px);
  overflow-y: auto;
}

.tickets-summary {
  background: #f8f9fa;
  padding: 15px;
  border-radius: 8px;
  margin-bottom: 20px;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
}

.summary-item {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 14px;
}

.summary-item i {
  color: #3a86ff;
  font-size: 16px;
  width: 20px;
}

.tickets-list {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 12px;
  margin-bottom: 20px;
  max-height: 400px;
  overflow-y: auto;
  padding: 5px;
}


.ticket-item:hover {
  border-color: #3a86ff;
  transform: translateY(-2px);
  box-shadow: 0 4px 15px rgba(58, 134, 255, 0.1);
}

.ticket-header {
  display: flex;
  justify-content: between;
  align-items: center;
  margin-bottom: 10px;
  padding-bottom: 10px;
  border-bottom: 1px solid #eee;
}

.ticket-code {
  font-family: 'Courier New', monospace;
  font-weight: bold;
  font-size: 1.1rem;
  color: #3a86ff;
  background: #f0f7ff;
  padding: 4px 8px;
  border-radius: 4px;
}

.ticket-status {
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: 500;
}

.status-active {
  background: #4caf50;
  color: white;
}

.status-used {
  background: #ff9800;
  color: white;
}

.status-invalid {
  background: #f44336;
  color: white;
}

.ticket-info {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin-bottom: 10px;
}

.ticket-info-item {
  display: flex;
  flex-direction: column;
  gap: 2px;
}

.ticket-label {
  font-size: 0.8rem;
  color: #666;
  font-weight: 500;
}

.ticket-value {
  font-weight: 600;
  color: #333;
}

.ticket-actions {
  display: flex;
  gap: 10px;
  justify-content: flex-end;
  margin-top: 10px;
}

.ticket-action-btn {
  padding: 6px 12px;
  border: none;
  border-radius: 4px;
  font-size: 0.8rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 4px;
  transition: all 0.2s;
}

.ticket-action-btn:hover {
  transform: translateY(-1px);
}

.btn-view {
  background: #3a86ff;
  color: white;
}

.btn-invalidate {
  background: #ff6b6b;
  color: white;
}

.modal-actions {
  display: flex;
  gap: 10px;
  justify-content: flex-end;
  padding-top: 20px;
  border-top: 1px solid #eee;
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –±–∏–ª–µ—Ç–æ–≤ */
.ticket-item {
  animation: ticketAppear 0.4s ease;
}

@keyframes ticketAppear {
  from {
    opacity: 0;
    transform: translateX(-20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
  .tickets-modal {
    width: 95%;
    margin: 10px;
  }
  
  .tickets-summary {
    grid-template-columns: 1fr;
  }
  
  .ticket-info {
    grid-template-columns: 1fr;
  }
  
  .modal-actions {
    flex-direction: column;
  }
  
  .modal-actions button {
    width: 100%;
  }
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –ø–µ—á–∞—Ç–∏ */
@media print {
  .modal-header,
  .modal-actions,
  .ticket-actions {
    display: none !important;
  }
  
  .tickets-modal {
    box-shadow: none;
    max-width: none;
    max-height: none;
  }
  
  .ticket-item {
    break-inside: avoid;
    border: 2px solid #000;
  }
}

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±–∏–ª–µ—Ç–∞—Ö */
.tickets-info {
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    margin-top: 20px;
    border-left: 4px solid #4caf50;
}

.tickets-info h3 {
    margin: 0 0 15px 0;
    color: #333;
}


.ticket-item {
    display: grid;
    grid-template-columns: 1fr 2fr 1fr;
    gap: 15px;
    padding: 12px;
    background: #f8f9fa;
    border-radius: 6px;
    border-left: 3px solid #3a86ff;
}

.ticket-code {
    font-family: 'Courier New', monospace;
    font-weight: bold;
    color: #3a86ff;
}

.ticket-seat {
    color: #666;
}

.ticket-price {
    font-weight: bold;
    color: #ff006e;
    text-align: right;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .ticket-item {
        grid-template-columns: 1fr;
        gap: 5px;
    }
    
    .ticket-price {
        text-align: left;
    }
}

/* –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
.hall-visualization {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
}

.hall-layout {
    display: flex;
    flex-direction: column;
    gap: 5px;
    min-height: 200px;
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
}

.hall-row {
    display: flex;
    gap: 3px;
    align-items: center;
}

.row-number {
    width: 30px;
    text-align: center;
    font-weight: bold;
    color: #666;
}

.seat {
    width: 30px;
    height: 30px;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    cursor: pointer;
    border: 1px solid #ddd;
    transition: all 0.2s ease;
}

.seat.free {
    background: #4caf50;
    color: white;
}

.seat.free:hover {
    background: #3d8b40;
    transform: scale(1.1);
}

.seat.taken {
    background: #f44336;
    color: white;
    cursor: not-allowed;
}

.seat.selected {
    background: #3a86ff;
    color: white;
    border: 2px solid #ffeb3b;
}

.hall-stage {
    background: #333;
    color: white;
    text-align: center;
    padding: 10px;
    margin-bottom: 15px;
    border-radius: 5px;
    font-weight: bold;
}

/* –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö */
.error {
    color: #f44336;
    padding: 20px;
    text-align: center;
    background: #ffebee;
    border-radius: 5px;
    border: 1px solid #f44336;
}
        

/* –°—Ç–∏–ª–∏ –¥–ª—è –±–∏–ª–µ—Ç–æ–≤ */
.tickets-container {
  display: grid;
  gap: 20px;
  margin: 30px 0;
}

.ticket-card {
  background: white;
  border-radius: 10px;
  padding: 20px;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
  border-left: 4px solid #3a86ff;
}

.ticket-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
  padding-bottom: 15px;
  border-bottom: 1px solid #eee;
}

.ticket-code {
  font-family: 'Courier New', monospace;
  font-weight: bold;
  font-size: 1.2rem;
  color: #3a86ff;
}

.ticket-status {
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: 500;
}

.status-active {
  background: #4caf50;
  color: white;
}

.status-used {
  background: #ff9800;
  color: white;
}

.status-invalid {
  background: #f44336;
  color: white;
}

.ticket-info h3 {
  margin-bottom: 10px;
  color: #333;
}

.ticket-info p {
  margin-bottom: 8px;
  color: #666;
  display: flex;
  align-items: center;
}

.ticket-info i {
  margin-right: 8px;
  width: 16px;
  color: #3a86ff;
}

.ticket-actions {
  margin-top: 15px;
  display: flex;
  gap: 10px;
}

.no-tickets {
  text-align: center;
  padding: 40px;
  color: #666;
}

.no-tickets i {
  font-size: 3rem;
  color: #ddd;
  margin-bottom: 15px;
}

.no-tickets h3 {
  margin-bottom: 10px;
  color: #333;
}

/* –ö–Ω–æ–ø–∫–∏ */
.btn-secondary {
  background: #6c757d;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 0.9rem;
}

.btn-warning {
  background: #ff9800;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 0.9rem;
}

.btn-secondary:hover {
  background: #5a6268;
}

.btn-warning:hover {
  background: #e68a00;
}

/* –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –∫–Ω–æ–ø–∫–∏ –ø–æ–∫—É–ø–∫–∏ */
.book-btn {
  background: #3a86ff;
  color: white;
  border: none;
  padding: 12px 20px;
  border-radius: 6px;
  width: 100%;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s ease;
  font-size: 16px;
}

.book-btn:hover {
  background: #2a75f0;
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
}

.book-btn:active {
  transform: translateY(0);
}

/* –°—Ç–∏–ª—å –¥–ª—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏ */
.book-btn:disabled {
  background: #ccc;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
@media (max-width: 768px) {
  .book-btn {
    padding: 10px 16px;
    font-size: 14px;
  }
}

.event-id {
  font-size: 12px;
  color: #666;
  margin-bottom: 10px;
  font-family: 'Courier New', monospace;
}

        .ticket-purchase-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .purchase-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .purchase-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        .event-details-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.1);
        }
        
        .event-image-large {
            width: 100%;
            height: 200px;
            background-color: #8338ec;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 500;
            background-size: cover;
            background-position: center;
        }
        
        .event-info h2 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .event-info-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            color: #666;
        }
        
        .event-info-item i {
            width: 20px;
            margin-right: 10px;
            color: #3a86ff;
        }
        
        .ticket-form-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.1);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }
        
        .quantity-control {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .quantity-btn {
            width: 40px;
            height: 40px;
            border: 1px solid #3a86ff;
            background: white;
            border-radius: 50%;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .quantity-display {
            font-size: 18px;
            font-weight: 600;
            min-width: 30px;
            text-align: center;
        }
        
        .price-summary {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .price-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        
        .price-total {
            display: flex;
            justify-content: space-between;
            font-size: 1.2rem;
            font-weight: 600;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #ddd;
        }
        
        .purchase-btn {
            background: #ff006e;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: background 0.3s;
        }
        
        .purchase-btn:hover {
            background: #e00064;
        }
        
        .purchase-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .ticket-notice {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #3a86ff;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
        }
        
        .error-message {
            background: #ffe6e6;
            color: #d32f2f;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #d32f2f;
        }
        
        @media (max-width: 768px) {
            .purchase-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo" onclick="window.location.href='/'">Ticket<span>Flow</span></div>
                <nav>
                    <ul>
                        <li><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></li>
                        <li><a href="#" onclick="history.back()">–ù–∞–∑–∞–¥</a></li>
                    </ul>
                </nav>
                <div class="header-buttons" id="headerAuthButtons">
                    <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ —Å–∫—Ä–∏–ø—Ç–æ–º -->
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <div class="container">
            <div class="ticket-purchase-container">
                <div class="purchase-header">
                    <h1>–ü–æ–∫—É–ø–∫–∞ –±–∏–ª–µ—Ç–∞</h1>
                    <p>–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–æ–∫—É–ø–∫–∏</p>
                </div>
                
                <div id="loading" class="loading">
                    <i class="fas fa-spinner fa-spin fa-2x"></i>
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏...</p>
                </div>
                
                <div id="errorContainer" class="error-message" style="display: none;">
                    <!-- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö -->
                </div>
                
                <div id="purchaseContent" style="display: none;">
                    <div class="purchase-content">
                        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏ -->
                        <div class="event-details-card">
                            <div class="event-image-large" id="eventImage">
                                –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è...
                            </div>
                            <div class="event-info">
                                <h2 id="eventTitle">–ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h2>
                                <div class="event-info-item">
                                    <i class="fas fa-calendar"></i>
                                    <span id="eventDate">–î–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏...</span>
                                </div>
                                <div class="event-info-item">
                                    <i class="fas fa-clock"></i>
                                    <span id="eventTime">–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏...</span>
                                </div>
                                <div class="event-info-item">
                                    <i class="fas fa-map-marker-alt"></i>
                                    <span id="eventLocation">–ú–µ—Å—Ç–æ –∑–∞–≥—Ä—É–∑–∫–∏...</span>
                                </div>
                                <div class="event-info-item">
                                    <i class="fas fa-user"></i>
                                    <span id="eventOrganizer">–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏...</span>
                                </div>
                                <div class="event-info-item">
                                    <i class="fas fa-ticket-alt"></i>
                                    <span id="eventTickets">–î–æ—Å—Ç—É–ø–Ω–æ –±–∏–ª–µ—Ç–æ–≤: –∑–∞–≥—Ä—É–∑–∫–∞...</span>
                                </div>
                                <div class="event-description">
                                    <p id="eventDescription">–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –§–æ—Ä–º–∞ –ø–æ–∫—É–ø–∫–∏ -->
                        <div class="ticket-form-card">
                            <h3>–î–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–∫—É–ø–∫–∏</h3>
                            
                            <div class="form-group">
                                <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∏–ª–µ—Ç–æ–≤</label>
                                <div class="quantity-control">
                                    <button class="quantity-btn" onclick="changeQuantity(-1)">-</button>
                                    <span class="quantity-display" id="quantity">1</span>
                                    <button class="quantity-btn" onclick="changeQuantity(1)">+</button>
                                </div>
                                <small>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–æ—Å—Ç—É–ø–Ω–æ: <span id="maxTickets">0</span> –±–∏–ª–µ—Ç–æ–≤</small>
                            </div>
                            
                            <label for="fruits">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ—Ä—É–∫—Ç:</label>
<select id="fruits" name="fruits">
  <option value="apple">–Ø–±–ª–æ–∫–æ</option>
  <option value="banana">–ë–∞–Ω–∞–Ω</option>
  <option value="orange">–ê–ø–µ–ª—å—Å–∏–Ω</option>
  <option value="pear">–ì—Ä—É—à–∞</option>
</select>

                            <div class="price-summary">
                                <h4>–°—Ç–æ–∏–º–æ—Å—Ç—å</h4>
                                <div class="price-item">
                                    <span>–¶–µ–Ω–∞ –∑–∞ –±–∏–ª–µ—Ç:</span>
                                    <span id="ticketPrice">0 —Ç–≥.</span>
                                </div>
                                <div class="price-item">
                                    <span>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</span>
                                    <span id="quantitySummary">1 —à—Ç.</span>
                                </div>
                                <div class="price-total">
                                    <span>–ò—Ç–æ–≥–æ:</span>
                                    <span id="totalPrice">0 —Ç–≥.</span>
                                </div>
                            </div>
                            
                            <div id="userInfo" style="display: none;">
                                <div class="form-group">
                                    <label>–ü–æ–∫—É–ø–∞—Ç–µ–ª—å</label>
                                    <p><strong id="userName">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</strong></p>
                                    <p id="userEmail">Email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</p>
                                </div>
                            </div>
                            
                            <div id="authRequired" style="display: none;">
                                <div class="error-message">
                                    <p>–î–ª—è –ø–æ–∫—É–ø–∫–∏ –±–∏–ª–µ—Ç–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</p>
                                </div>
                                <button class="purchase-btn" onclick="window.location.href='/?login=true'">
                                    –í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É
                                </button>
                            </div>
                            
                           <button id="purchaseButton" class="purchase-btn" onclick="purchaseTickets()">
                                –ö—É–ø–∏—Ç—å –±–∏–ª–µ—Ç—ã
                            </button>

                       
                           
                            
                            <div class="ticket-notice">
                                <h4><i class="fas fa-info-circle"></i> –í–∞–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h4>
                                <p>–ü–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –±–∏–ª–µ—Ç—ã —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –∫–æ–¥–∞–º–∏. 
                                   –ë–∏–ª–µ—Ç—ã –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –Ω–∞–π—Ç–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ "–ú–æ–∏ –±–∏–ª–µ—Ç—ã".</p>
                                <p>–ö–∞–∂–¥—ã–π –±–∏–ª–µ—Ç –∏–º–µ–µ—Ç —Å—Ç–∞—Ç—É—Å: <strong>–ê–∫—Ç–∏–≤–µ–Ω</strong>, 
                                   <strong>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω</strong> –∏–ª–∏ <strong>–ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω</strong>.</p>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
                                    <!-- –î–æ–±–∞–≤–ª—è–µ–º –ø–æ—Å–ª–µ —Ñ–æ—Ä–º—ã –ø–æ–∫—É–ø–∫–∏ -->
<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É—Å–ø–µ—à–Ω–æ–π –ø–æ–∫—É–ø–∫–∏ -->
<div class="modal-overlay" id="purchaseSuccessModal">
  <div class="tickets-modal">
    <div class="modal-header">
      <h2>–ü–æ–∫—É–ø–∫–∞ —É—Å–ø–µ—à–Ω–∞! üéâ</h2>
      <button class="close-modal" onclick="closePurchaseSuccessModal()">&times;</button>
    </div>
    
    <div class="modal-body">
      <div class="purchase-success-content">
        <div class="success-icon">
          <i class="fas fa-check-circle"></i>
        </div>
        
        <div class="success-message">
          <h3>–í—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–æ–±—Ä–µ–ª–∏ –±–∏–ª–µ—Ç—ã!</h3>
          <p>–ö—É–ø–ª–µ–Ω–æ <strong id="purchasedTicketsCount">0</strong> –±–∏–ª–µ—Ç–æ–≤ –Ω–∞ —Å—É–º–º—É <strong id="purchasedTotalPrice">0</strong> —Ç–≥.</p>
        </div>
        
        <div class="ticket-codes-preview">
          <h4>–ö–æ–¥—ã –≤–∞—à–∏—Ö –±–∏–ª–µ—Ç–æ–≤:</h4>
          <div class="codes-preview-container" id="ticketCodesPreview"></div>
        </div>
        
        <div class="purchase-actions">
          <button class="btn-primary" onclick="closePurchaseSuccessModal()">
            <i class="fas fa-check"></i> –û—Ç–ª–∏—á–Ω–æ!
          </button>
          <button class="btn-secondary" onclick="openPrintPage()">
            <i class="fas fa-print"></i> –ü–µ—á–∞—Ç—å –±–∏–ª–µ—Ç–æ–≤
          </button>
          <button class="btn-secondary" onclick="copyAllTicketCodes()">
            <i class="fas fa-copy"></i> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥—ã
          </button>
        </div>
      </div>
    </div>
  </div>
                                </div>
  </div>
</div>
<!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –ø–µ—á–∞—Ç–∏ –±–∏–ª–µ—Ç–æ–≤ -->
<div id="printPage" style="display: none;">
  <div class="print-container">
    <header class="print-header">
      <div class="print-logo">
        <h1>Ticket<span>Flow</span></h1>
        <p>–í–∞—à–∏ –±–∏–ª–µ—Ç—ã</p>
      </div>
      <div class="print-event-info">
        <h2 id="printEventTitle"></h2>
        <p id="printEventDate"></p>
        <p id="printEventLocation"></p>
      </div>
      <div class="print-controls no-print">
    <button class="btn-secondary" onclick="closePrintPage()">
      <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥
    </button>
    <button class="btn-primary" onclick="window.print()">
      <i class="fas fa-print"></i> –ü–µ—á–∞—Ç—å
    </button>
    <button class="btn-secondary" onclick="downloadAsPDF()">
      <i class="fas fa-file-pdf"></i> –°–∫–∞—á–∞—Ç—å PDF
    </button>
  </div>
    </header>

    <div class="print-tickets" id="printTicketsContainer">
      <!-- –ë–∏–ª–µ—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –∑–¥–µ—Å—å -->
    </div>

    <footer class="print-footer">
      <p>–ë–∏–ª–µ—Ç—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã: <span id="printGenerationDate"></span></p>
      <p>–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É: support@ticketflow.ru</p>
    </footer>
  </div>
</div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <h3>–û –Ω–∞—Å</h3>
                    <ul>
                        <li><a href="#">–û –∫–æ–º–ø–∞–Ω–∏–∏</a></li>
                        <li><a href="#">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></li>
                        <li><a href="#">–ü–∞—Ä—Ç–Ω–µ—Ä—ã</a></li>
                        <li><a href="#">–†–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª—è–º</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>–ü–æ–º–æ—â—å</h3>
                    <ul>
                        <li><a href="#">–ö–∞–∫ –∫—É–ø–∏—Ç—å –±–∏–ª–µ—Ç</a></li>
                        <li><a href="#">–í–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã</a></li>
                        <li><a href="#">–ü—Ä–∞–≤–∏–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</a></li>
                        <li><a href="#">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
                    <ul>
                        <li>–¢–µ–ª–µ—Ñ–æ–Ω: +7 (800) 123-45-67</li>
                        <li>Email: info@ticketflow.ru</li>
                        <li>–ê–¥—Ä–µ—Å: –ú–æ—Å–∫–≤–∞, —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, –¥. 10</li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h3>–ü–æ–¥–ø–∏—Å–∫–∞</h3>
                    <p>–ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ —Ä–∞—Å—Å—ã–ª–∫—É, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–æ–≤—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è—Ö –∏ –∞–∫—Ü–∏—è—Ö</p>
                    <form>
                        <input type="email" placeholder="–í–∞—à email" style="padding: 10px; width: 100%; margin: 10px 0; border-radius: 4px; border: none;">
                        <button type="submit" class="search-btn" style="margin-top: 10px;">–ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è</button>
                    </form>
                </div>
            </div>
            <div class="copyright">
                <p>¬© 2023 TicketFlow. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
            </div>
        </div>
    </footer>

    <script src="/js/auth.js"></script>
    <script src="/js/notifications.js"></script>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É
    setTimeout(() => {
        if (currentEvent) {
            initSimpleHall();
        }
    }, 500);
});
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentEvent = null;
        let currentQuantity = 1;
        let ticketPrice = 0;
        
        
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
async function initPage() {
  // –ü–æ–ª—É—á–∞–µ–º ID –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –∏–∑ URL
  const pathParts = window.location.pathname.split('/');
  const eventId = pathParts[2]; // /event/:id/tickets
  
  if (!eventId) {
    showError('–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –Ω–µ —É–∫–∞–∑–∞–Ω–æ');
    return;
  }
  
  // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏
  await loadEventInfo(eventId);
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  updatePurchaseUI();
  
  // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å
  updatePrice();

}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –æ–±–ª–∞—Å—Ç–∏
document.addEventListener('click', function(e) {
  const modal = document.getElementById('ticketsModal');
  if (modal && modal.classList.contains('active') && e.target === modal) {
    closeTicketsModal();
  }
});

// –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∞–≤–∏—à–µ Escape
document.addEventListener('keydown', function(e) {
  const modal = document.getElementById('ticketsModal');
  if (modal && modal.classList.contains('active') && e.key === 'Escape') {
    closeTicketsModal();
  }
});
        

//         // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏
// async function loadEventInfo(eventId) {
//   try {
//     const response = await fetch(`/api/events/id/${eventId}`);
//     const data = await response.json();
    
//     if (data.status === 'success') {
//       currentEvent = data.event;
//       displayEventInfo();
//       hideLoading();
//     } else {
//       showError(data.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏');
//     }
//   } catch (error) {
//     console.error('–û—à–∏–±–∫–∞:', error);
//     showError('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏');
//   }
//}
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏
        function displayEventInfo() {
            if (!currentEvent) return;
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏
            document.getElementById('eventTitle').textContent = currentEvent.title;
            document.getElementById('eventDescription').textContent = currentEvent.description;
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É
            const eventDate = new Date(currentEvent.date).toLocaleDateString('ru-RU', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
            document.getElementById('eventDate').textContent = eventDate;
            
            document.getElementById('eventTime').textContent = currentEvent.time;
            document.getElementById('eventLocation').textContent = `${currentEvent.venue}, ${currentEvent.city}`;
            document.getElementById('eventOrganizer').textContent = `–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä: ${currentEvent.organizer}`;
            document.getElementById('eventTickets').textContent = `–î–æ—Å—Ç—É–ø–Ω–æ –±–∏–ª–µ—Ç–æ–≤: ${currentEvent.ticketsAvailable}`;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            const eventImage = document.getElementById('eventImage');
            if (currentEvent.image) {
                eventImage.style.backgroundImage = `url('${currentEvent.image}')`;
                eventImage.textContent = '';
            } else {
                eventImage.textContent = currentEvent.title;
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–µ–Ω—É –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
            ticketPrice = currentEvent.price;
            document.getElementById('ticketPrice').textContent = `${ticketPrice} —Ç–≥.`;
            document.getElementById('maxTickets').textContent = currentEvent.ticketsAvailable;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ–∫—É–ø–∫–∏
            updatePurchaseButton();
        }
        
        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±–∏–ª–µ—Ç–æ–≤
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±–∏–ª–µ—Ç–æ–≤
// –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
function changeQuantity(delta) {
    const newQuantity = currentQuantity + delta;
    const maxTickets = currentEvent ? currentEvent.ticketsAvailable : 0;
    
    if (newQuantity >= 1 && newQuantity <= maxTickets) {
        currentQuantity = newQuantity;
        document.getElementById('quantity').textContent = currentQuantity;
        updatePrice();
        
        // –ï—Å–ª–∏ –ø—Ä–µ–≤—ã—Å–∏–ª–∏ –ª–∏–º–∏—Ç –≤—ã–±–æ—Ä–∞ - –æ—á–∏—â–∞–µ–º –ª–∏—à–Ω–µ–µ
        if (selectedSeats.length > currentQuantity) {
            selectedSeats = selectedSeats.slice(0, currentQuantity);
            initSimpleHall();
        }
        
    }
}
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏
        function updatePrice() {
            const total = currentQuantity * ticketPrice;
            const amount = currentQuantity;
            document.getElementById('totalPrice').textContent = `${total} —Ç–≥.`;
            document.getElementById('quantitySummary').textContent = `${amount} —à—Ç.`;
        }

       
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø–æ–∫—É–ø–∫–∏
        function updatePurchaseUI() {
            const isAuthenticated = auth.isAuthenticated();
            const userInfo = document.getElementById('userInfo');
            const authRequired = document.getElementById('authRequired');
            const purchaseButton = document.getElementById('purchaseButton');
            
            if (isAuthenticated) {
                userInfo.style.display = 'block';
                authRequired.style.display = 'none';
                purchaseButton.style.display = 'block';
                
                document.getElementById('userName').textContent = auth.user.name;
                document.getElementById('userEmail').textContent = auth.user.email;
            } else {
                userInfo.style.display = 'none';
                authRequired.style.display = 'block';
                purchaseButton.style.display = 'none';
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –ø–æ–∫—É–ø–∫–∏
        function updatePurchaseButton() {
            const purchaseButton = document.getElementById('purchaseButton');
            const isAuthenticated = auth.isAuthenticated();
            const hasTickets = currentEvent && currentEvent.ticketsAvailable > 0;
            
            if (isAuthenticated && hasTickets && currentQuantity > 0) {
                purchaseButton.disabled = false;
                purchaseButton.textContent = `–ö—É–ø–∏—Ç—å –±–∏–ª–µ—Ç`;
            } else {
                purchaseButton.disabled = true;
            }
        }
        
        // –ü–æ–∫—É–ø–∫–∞ –±–∏–ª–µ—Ç–æ–≤
        // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –ø–æ–∫—É–ø–∫–∏ –±–∏–ª–µ—Ç–æ–≤
// –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –ø–æ–∫—É–ø–∫–∏
async function purchaseTickets() {
  if (!auth.isAuthenticated()) {
    notifications.warning('–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è', '–î–ª—è –ø–æ–∫—É–ø–∫–∏ –±–∏–ª–µ—Ç–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É!');
    return;
  }

  // –î–ª—è reserved seating –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –º–µ—Å—Ç–∞
  if (currentEventSeatingConfig && currentEventSeatingConfig.type === 'reserved') {
    if (selectedSeats.length !== currentQuantity) {
      notifications.error('–û—à–∏–±–∫–∞', `–í—ã–±–µ—Ä–∏—Ç–µ ${currentQuantity} –º–µ—Å—Ç(–∞) –¥–ª—è –ø–æ–∫—É–ø–∫–∏`);
      return;
    }
  }

  try {
    const result = await ticketsManager.purchaseTicket(
      currentEvent._id, 
      currentQuantity, 
      '', 
      currentEventSeatingConfig.type === 'reserved' ? selectedSeats : []
    );
    
    if (result.success) {
      console.log('–£—Å–ø–µ—Ö!', result.message);
      // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏...
    } else {
      console.log('–û—à–∏–±–∫–∞', result.message);
    }
  } catch (error) {
    console.log('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—åÂÆåÊàê –ø–æ–∫—É–ø–∫—É');
  }
}
// –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–∫—É–ø–∫–∏ –±–∏–ª–µ—Ç–æ–≤
async function purchaseTickets() {
    console.log('–ù–∞—á–∞–ª–æ –ø–æ–∫—É–ø–∫–∏ –±–∏–ª–µ—Ç–æ–≤...');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
    if (!auth.isAuthenticated()) {
       console.log('warning', '–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è', '–î–ª—è –ø–æ–∫—É–ø–∫–∏ –±–∏–ª–µ—Ç–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É');
        openLoginModal();
        return;
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
    if (!currentEvent || !currentEvent._id) {
         console.log('error', '–û—à–∏–±–∫–∞', '–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –Ω–µ –≤—ã–±—Ä–∞–Ω–æ');
        return;
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø —Ä–∞—Å—Å–∞–¥–∫–∏ –∏ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –º–µ—Å—Ç–∞
    const seatingConfig = currentEvent.seatingConfig || { type: 'free' };
    
    if (seatingConfig.type === 'reserved') {
        // –î–ª—è reserved seating –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –º–µ—Å—Ç–∞
        if (selectedSeats.length === 0) {
             console.log('error', '–û—à–∏–±–∫–∞', '–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—Ç–∞ –¥–ª—è –ø–æ–∫—É–ø–∫–∏');
            return;
        }
        
        if (selectedSeats.length !== currentQuantity) {
            console.log('error', '–û—à–∏–±–∫–∞', `–í—ã–±–µ—Ä–∏—Ç–µ ${currentQuantity} –º–µ—Å—Ç(–∞)`);
            return;
        }
    }

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
    const purchaseBtn = document.getElementById('purchaseButton');
    const originalText = purchaseBtn.textContent;
    purchaseBtn.disabled = true;
    purchaseBtn.textContent = '–ü–æ–∫—É–ø–∫–∞...';

    try {
        console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –ø–æ–∫—É–ø–∫—É...');
        
        // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
        const requestData = {
            eventId: currentEvent._id,
            quantity: currentQuantity
        };

        // –î–æ–±–∞–≤–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –º–µ—Å—Ç–∞ –¥–ª—è reserved seating
        if (seatingConfig.type === 'reserved' && selectedSeats.length > 0) {
            requestData.selectedSeats = selectedSeats;
        }

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
        const response = await fetch('/api/tickets/purchase', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${auth.token}`
            },
            body: JSON.stringify(requestData)
        });

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–≤–µ—Ç
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const result = await response.json();
        console.log('–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', result);

        if (result.status === 'success') {
            // –£—Å–ø–µ—à–Ω–∞—è –ø–æ–∫—É–ø–∫–∞
            console.log('success', '–£—Å–ø–µ—Ö!', result.message);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–∏–ª–µ—Ç–∞—Ö
            showPurchaseSuccessModal(tickets);
            
            // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–æ—Ñ–∏–ª—è —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            // setTimeout(() => {
            //     window.location.href = '/profile?tickets=true';
            // }, 3000);
            
        } else {
            // –û—à–∏–±–∫–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
            console.log('error', '–û—à–∏–±–∫–∞', result.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
        }

    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø–æ–∫—É–ø–∫–∏:', error);
        console.log('error', '–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—åÂÆåÊàê –ø–æ–∫—É–ø–∫—É. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
    } finally {
        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
        purchaseBtn.disabled = false;
        purchaseBtn.textContent = originalText;
    }
}

// –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
function openTicketsModal() {
  const modal = document.getElementById('ticketsModal');
  if (modal) {
    modal.classList.add('active');
    document.body.style.overflow = 'hidden'; // –ë–ª–æ–∫–∏—Ä—É–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É —Ñ–æ–Ω–∞
  }
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
function closeTicketsModal() {
  const modal = document.getElementById('ticketsModal');
  if (modal) {
    modal.classList.remove('active');
    document.body.style.overflow = ''; // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É
  }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
function updateTicketsModal(tickets) {
  // –û–±–Ω–æ–≤–ª—è–µ–º summary
  updateTicketsSummary(tickets);
  
  // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –±–∏–ª–µ—Ç–æ–≤
  updateTicketsList(tickets);
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ summary –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
function updateTicketsSummary(tickets) {
  const totalTickets = tickets.length;
  const totalPrice = tickets.reduce((sum, ticket) => sum + (ticket.price || 0), 0);
  const purchaseDate = new Date().toLocaleDateString('ru-RU');
  
  document.getElementById('ticketsCount').textContent = totalTickets;
  document.getElementById('ticketsTotalPrice').textContent = totalPrice;
  document.getElementById('purchaseDate').textContent = purchaseDate;
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –±–∏–ª–µ—Ç–æ–≤
function updateTicketsList(tickets) {
  const ticketsList = document.getElementById('ticketsList');
  ticketsList.innerHTML = '';
  
  tickets.forEach((ticket, index) => {
    const ticketElement = createTicketElement(ticket, index);
    ticketsList.appendChild(ticketElement);
  });
}

// –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –±–∏–ª–µ—Ç–∞
function createTicketElement(ticket, index) {
  const ticketDiv = document.createElement('div');
  ticketDiv.className = 'ticket-item';
  ticketDiv.style.animationDelay = `${index * 0.1}s`;
  
  const eventDate = ticket.event?.date ? new Date(ticket.event.date).toLocaleDateString('ru-RU') : '-';
  const eventTime = ticket.event?.time || '-';
  
  ticketDiv.innerHTML = `
    <div class="ticket-header">
      <span class="ticket-code">${ticket.code || 'N/A'}</span>
      <span class="ticket-status status-${getStatusClass(ticket.status)}">
        ${ticket.status || '–ê–∫—Ç–∏–≤–µ–Ω'}
      </span>
    </div>
    
    <div class="ticket-info">
      <div class="ticket-info-item">
        <span class="ticket-label">–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</span>
        <span class="ticket-value">${ticket.event?.title || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</span>
      </div>
      
      <div class="ticket-info-item">
        <span class="ticket-label">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</span>
        <span class="ticket-value">${eventDate}, ${eventTime}</span>
      </div>
      
      <div class="ticket-info-item">
        <span class="ticket-label">–ú–µ—Å—Ç–æ</span>
        <span class="ticket-value">${ticket.seat || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</span>
      </div>
      
      <div class="ticket-info-item">
        <span class="ticket-label">–¶–µ–Ω–∞</span>
        <span class="ticket-value">${ticket.price || 0} —Ç–≥.</span>
      </div>
      
      <div class="ticket-info-item">
        <span class="ticket-label">–ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è</span>
        <span class="ticket-value">${ticket.event?.venue || '-'}, ${ticket.event?.city || '-'}</span>
      </div>
      
      <div class="ticket-info-item">
        <span class="ticket-label">–°—Ç–∞—Ç—É—Å</span>
        <span class="ticket-value">${ticket.status || '–ê–∫—Ç–∏–≤–µ–Ω'}</span>
      </div>
    </div>
  `;
  
  return ticketDiv;
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–ª–∞—Å—Å–∞ —Å—Ç–∞—Ç—É—Å–∞
function getStatusClass(status) {
  const statusMap = {
    '–ê–∫—Ç–∏–≤–µ–Ω': 'active',
    '–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω': 'used',
    '–ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω': 'invalid'
  };
  return statusMap[status] || 'active';
}

function printTickets() {
  const printContent = document.getElementById('purchaseSuccessModal').cloneNode(true);
  
  // –£–±–∏—Ä–∞–µ–º –Ω–µ–Ω—É–∂–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –ø–µ—á–∞—Ç–∏
  const elementsToRemove = printContent.querySelectorAll('.modal-header, .purchase-actions, .close-modal');
  elementsToRemove.forEach(el => el.remove());
  
  // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–µ—á–∞—Ç–∏
  const printWindow = window.open('', '_blank');
  printWindow.document.write(`
    <!DOCTYPE html>
    <html>
    <head>
      <title>–ë–∏–ª–µ—Ç—ã –Ω–∞ ${currentEvent.title}</title>
      <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .qr-code-item { margin: 10px; display: inline-block; text-align: center; }
        .qr-code-container { margin: 0 auto; }
        .ticket-code-badge { 
          background: #000; color: #fff; padding: 5px 10px; 
          margin: 2px; border-radius: 10px; font-family: monospace;
        }
        @media print {
          .qr-code-item { break-inside: avoid; }
        }
      </style>
    </head>
    <body>
      <h1>–ë–∏–ª–µ—Ç—ã –Ω–∞: ${currentEvent.title}</h1>
      <p>–î–∞—Ç–∞: ${new Date(currentEvent.date).toLocaleDateString('ru-RU')} –≤ ${currentEvent.time}</p>
      <p>–ú–µ—Å—Ç–æ: ${currentEvent.venue}, ${currentEvent.city}</p>
      <hr>
      ${printContent.innerHTML}
    </body>
    </html>
  `);
  
  printWindow.document.close();
  printWindow.focus();
  
  // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
  setTimeout(() => {
    printWindow.print();
    // printWindow.close(); // –ú–æ–∂–Ω–æ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è
  }, 500);
}

// –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π –±–∏–ª–µ—Ç–∞
function viewTicketDetails(ticketCode) {
  // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
  alert(`–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–∏–ª–µ—Ç–µ ${ticketCode}`);
  
  // –ò–ª–∏ –æ—Ç–∫—Ä—ã—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å QR-–∫–æ–¥–æ–º –∏ –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
  // openTicketDetailsModal(ticketCode);
}

// –ê–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∏–ª–µ—Ç–∞
function invalidateTicket(ticketCode) {
  if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞—Ç—å –±–∏–ª–µ—Ç ${ticketCode}?`)) {
    // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –≤—ã–∑–æ–≤ API –¥–ª—è –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∏—è –±–∏–ª–µ—Ç–∞
    alert('–ê–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ! –ë–∏–ª–µ—Ç ${ticketCode} –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞–Ω');
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
    updateTicketStatus(ticketCode, '–ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω');
  }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –±–∏–ª–µ—Ç–∞ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
function updateTicketStatus(ticketCode, newStatus) {
  const ticketElements = document.querySelectorAll('.ticket-item');
  ticketElements.forEach(element => {
    const codeElement = element.querySelector('.ticket-code');
    if (codeElement && codeElement.textContent === ticketCode) {
      const statusElement = element.querySelector('.ticket-status');
      if (statusElement) {
        statusElement.textContent = newStatus;
        statusElement.className = `ticket-status status-${getStatusClass(newStatus)}`;
      }
    }
  });
}

// –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±–∏–ª–µ—Ç–∞—Ö
// –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±–∏–ª–µ—Ç–∞—Ö
function showTicketsInfo(tickets) {
  if (!tickets || tickets.length === 0) {
    alert('–ù–µ—Ç –±–∏–ª–µ—Ç–æ–≤! –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∫—É–ø–ª–µ–Ω–Ω—ã—Ö –±–∏–ª–µ—Ç–æ–≤');
    return;
  }

  // –û—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
  openTicketsModal();
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
  updateTicketsModal(tickets);
  // –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
    const ticketContainer = document.createElement('div');
    ticketContainer.className = 'tickets-info';
    ticketContainer.innerHTML = `
        <h3>–í–∞—à–∏ –±–∏–ª–µ—Ç—ã</h3>
        <div class="tickets-list">
            ${tickets.map(ticket => `
                <div class="ticket-item">
                    <div class="ticket-code">${ticket.code}</div>
                    <div class="ticket-seat">${ticket.seat || '–ú–µ—Å—Ç–æ –±—É–¥–µ—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–æ'}</div>
                    <div class="ticket-price">${ticket.price} —Ç–≥.</div>
                </div>
            `).join('')}
        </div>
    `;
    
    document.querySelector('.purchase-content').appendChild(ticketContainer);
}

    //ticketInfo += '–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é! –ë–∏–ª–µ—Ç—ã —Ç–∞–∫–∂–µ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –≤–∞—à–µ–º –ø—Ä–æ—Ñ–∏–ª–µ.';
    
    
    

        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function getPluralEnding(number) {
            if (number % 10 === 1 && number % 100 !== 11) return '';
            if ([2, 3, 4].includes(number % 10) && ![12, 13, 14].includes(number % 100)) return '–∞';
            return '–æ–≤';
        }
        
        function showError(message) {
            const errorContainer = document.getElementById('errorContainer');
            errorContainer.innerHTML = `<p>${message}</p>`;
            errorContainer.style.display = 'block';
            hideLoading();
        }
        
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('purchaseContent').style.display = 'block';
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è
async function loadEventInfo(eventId) {
    try {
          const response = await fetch(`/api/events/id/${eventId}`);
        const data = await response.json();
        

        if (data.status === 'success') {
            currentEvent = data.event;
            displayEventInfo();
        hideLoading();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–Ω—è—Ç—ã–µ –º–µ—Å—Ç–∞
            await loadTakenSeats(eventId);
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–æ—Å—Ç–æ–π –∑–∞–ª
            initSimpleHall();
            
        } else {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', data.message);
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏:', error);
    }
}



// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let selectedSeats = [];
let takenSeats = [];
let currentEventSeatingConfig = null;

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–±–æ—Ä–∞ –º–µ—Å—Ç
async function initSeatSelection() {
  if (!currentEvent) return;
  
  // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –º–µ—Å—Ç
  currentEventSeatingConfig = currentEvent.seatingConfig || { type: 'free' };
  
  // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–Ω—è—Ç—ã–µ –º–µ—Å—Ç–∞
  await loadTakenSeats(currentEvent._id);
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤—ã–±–æ—Ä–∞ –º–µ—Å—Ç
  showSeatSelectionInterface();
  
  // –í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ–º –∑–∞–ª
  visualizeHallForPurchase();
  
  // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
  updateSelectionStats();
}

// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤—ã–±–æ—Ä–∞ –º–µ—Å—Ç
function showSeatSelectionInterface() {
  const selectionSection = document.querySelector('.seating-selection');
  if (selectionSection) {
    selectionSection.style.display = 'block';
  }
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–µ–±—É–µ–º—ã—Ö –º–µ—Å—Ç
  document.getElementById('totalRequiredSeats').textContent = currentQuantity;
}

// –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–ª–∞ –¥–ª—è –ø–æ–∫—É–ø–∫–∏
function visualizeHallForPurchase() {
  const container = document.getElementById('purchaseHallLayout');
  if (!container || !currentEventSeatingConfig) return;
  
  container.innerHTML = '';
  
  if (currentEventSeatingConfig.type === 'free') {
    visualizeFreeSeatingForPurchase();
  } else {
    visualizeReservedSeatingForPurchase();
  }
}

// –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–ª–∞
function visualizeHallForPurchase() {
    debugLog('–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–ª–∞ –∑–∞–ø—É—â–µ–Ω–∞');
    
    const container = document.getElementById('purchaseHallLayout');
    if (!container) {
        debugLog('–û—à–∏–±–∫–∞: –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ª–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
    }

    // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
    container.innerHTML = '';
    debugLog('–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –æ—á–∏—â–µ–Ω');

    if (!currentEventSeatingConfig) {
        debugLog('–û—à–∏–±–∫–∞: –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–µ—Å—Ç –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞');
        container.innerHTML = '<div class="error">–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–µ—Å—Ç –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞</div>';
        return;
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø —Ä–∞—Å—Å–∞–¥–∫–∏
    if (currentEventSeatingConfig.type === 'free') {
        debugLog('–¢–∏–ø: —Å–≤–æ–±–æ–¥–Ω–∞—è —Ä–∞—Å—Å–∞–¥–∫–∞');
        visualizeFreeSeating();
    } else if (currentEventSeatingConfig.type === 'reserved' && currentEventSeatingConfig.sections) {
        debugLog('–¢–∏–ø: reserved seating');
        visualizeReservedSeating();
    } else {
        debugLog('–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø —Ä–∞—Å—Å–∞–¥–∫–∏: ' + currentEventSeatingConfig.type);
        container.innerHTML = '<div class="error">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø —Ä–∞—Å—Å–∞–¥–∫–∏</div>';
    }
}

// –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è reserved seating
function visualizeReservedSeatingForPurchase() {
  const container = document.getElementById('purchaseHallLayout');
  
  currentEventSeatingConfig.sections.forEach(section => {
    // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü–∏–∏
    const sectionHeader = document.createElement('div');
    sectionHeader.className = 'section-header';
    sectionHeader.innerHTML = `<h4>${section.name} - ${section.price} —Ç–≥.</h4>`;
    container.appendChild(sectionHeader);
    
    // –ú–µ—Å—Ç–∞ —Å–µ–∫—Ü–∏–∏
    for (let row = 1; row <= section.rows; row++) {
      const rowDiv = document.createElement('div');
      rowDiv.className = 'hall-row';
      
      const rowNumber = document.createElement('div');
      rowNumber.className = 'row-number';
      rowNumber.textContent = row;
      rowDiv.appendChild(rowNumber);
      
      for (let seat = 1; seat <= section.seatsPerRow; seat++) {
        const seatDiv = createSeatElement(section.name, row, seat);
        rowDiv.appendChild(seatDiv);
      }
      
      container.appendChild(rowDiv);
    }
  });
}

// –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –º–µ—Å—Ç–∞
function createSeatElement(section, row, number) {
  const seatDiv = document.createElement('div');
  seatDiv.className = 'seat';
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–Ω—è—Ç–æ—Å—Ç—å –º–µ—Å—Ç–∞
  const isTaken = isSeatTaken(section, row, number);
  const isSelected = isSeatSelected(section, row, number);
  
  if (isTaken) {
    seatDiv.className = 'seat taken';
    seatDiv.title = '–ú–µ—Å—Ç–æ –∑–∞–Ω—è—Ç–æ';
  } else if (isSelected) {
    seatDiv.className = 'seat selected';
    seatDiv.title = '–í—ã–±—Ä–∞–Ω–æ –≤–∞–º–∏';
  } else {
    seatDiv.className = 'seat free';
    seatDiv.title = `${section}, –†—è–¥ ${row}, –ú–µ—Å—Ç–æ ${number}`;
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–≤–æ–±–æ–¥–Ω—ã—Ö –º–µ—Å—Ç
    seatDiv.addEventListener('click', () => handleSeatClick(section, row, number));
  }
  
  seatDiv.textContent = number;
  seatDiv.setAttribute('data-section', section);
  seatDiv.setAttribute('data-row', row);
  seatDiv.setAttribute('data-number', number);
  
  return seatDiv;
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –º–µ—Å—Ç—É
function handleSeatClick(section, row, number) {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–Ω–æ –ª–∏ –≤—ã–±—Ä–∞—Ç—å –µ—â–µ –º–µ—Å—Ç–∞
  if (selectedSeats.length >= currentQuantity && 
      !isSeatSelected(section, row, number)) {
    notifications.warning('–í–Ω–∏–º–∞–Ω–∏–µ', `–í—ã —É–∂–µ –≤—ã–±—Ä–∞–ª–∏ ${currentQuantity} –º–µ—Å—Ç(–∞)`);
    return;
  }
  
  // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –≤—ã–±–æ—Ä –º–µ—Å—Ç–∞
  toggleSeatSelection(section, row, number);
}

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞ –º–µ—Å—Ç–∞
function toggleSeatSelection(section, row, number) {
  const index = selectedSeats.findIndex(seat => 
    seat.section === section && seat.row === row && seat.number === number
  );
  
  if (index > -1) {
    // –£–±–∏—Ä–∞–µ–º –∏–∑ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö
    selectedSeats.splice(index, 1);
  } else {
    // –î–æ–±–∞–≤–ª—è–µ–º –≤ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ
    selectedSeats.push({ section, row, number });
  }
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é
  updateSeatVisualization();
  updateSelectionStats();
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –º–µ—Å—Ç
function updateSeatVisualization() {
  document.querySelectorAll('#purchaseHallLayout .seat').forEach(seat => {
    const section = seat.getAttribute('data-section');
    const row = parseInt(seat.getAttribute('data-row'));
    const number = parseInt(seat.getAttribute('data-number'));
    
    seat.classList.remove('selected');
    
    if (isSeatSelected(section, row, number)) {
      seat.classList.add('selected');
    }
  });
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–±–æ—Ä–∞ –º–µ—Å—Ç–∞
function isSeatSelected(section, row, number) {
  return selectedSeats.some(seat => 
    seat.section === section && 
    seat.row === row && 
    seat.number === number
  );
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
function updateSelectionStats() {
  document.getElementById('selectedSeatsCount').textContent = selectedSeats.length;
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç
  if (selectedSeats.length < currentQuantity && currentEventSeatingConfig.type === 'reserved') {
    notifications.info('–í—ã–±–æ—Ä –º–µ—Å—Ç', `–í—ã–±–µ—Ä–∏—Ç–µ –µ—â–µ ${currentQuantity - selectedSeats.length} –º–µ—Å—Ç(–∞)`);
  }
}

// –û—á–∏—Å—Ç–∫–∞ –≤—ã–±–æ—Ä–∞
function clearSelection() {
  selectedSeats = [];
  updateSeatVisualization();
  updateSelectionStats();
  notifications.info('–í—ã–±–æ—Ä –º–µ—Å—Ç', '–í—ã–±–æ—Ä –æ—á–∏—â–µ–Ω');
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–Ω—è—Ç—ã—Ö –º–µ—Å—Ç
async function loadTakenSeats(eventId) {
    try {
        const response = await fetch(`/api/events/${eventId}/taken-seats`);
        const data = await response.json();
        
        if (data.status === 'success') {
            takenSeats = data.takenSeats;
            console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–æ –∑–∞–Ω—è—Ç—ã—Ö –º–µ—Å—Ç:', takenSeats.length);
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–Ω—è—Ç—ã—Ö –º–µ—Å—Ç:', error);
    }
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–Ω—è—Ç–æ—Å—Ç–∏ –º–µ—Å—Ç–∞
function isSeatTaken(section, row, number) {
  return takenSeats.some(seat => 
    seat.section === section && 
    seat.seatRow === row && 
    seat.seatNumber === number
  );
}



// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            initPage();
            if (currentEvent) {
    setTimeout(initSeatSelection, 100);
  }
        });

        function initSimpleHall() {
    console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Å—Ç–æ–≥–æ –∑–∞–ª–∞...');
    
    if (!currentEvent) {
        console.log('–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ');
        return;
    }
    
    const container = document.getElementById('simpleHallLayout');
    if (!container) {
        console.log('–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ª–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
    }
    
    // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
    container.innerHTML = '';
    
    // –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
    const config = currentEvent.seatingConfig || { type: 'free', rows: 5, seatsPerRow: 10 };
    console.log('–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–ª–∞:', config);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç—Ä–µ–±—É–µ–º—ã—Ö –º–µ—Å—Ç
    document.getElementById('requiredCount').textContent = currentQuantity;
    
    // –°–æ–∑–¥–∞–µ–º –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é
    if (config.type === 'free') {
        createFreeSeating(config);
    } else if (config.type === 'reserved' && config.sections) {
        createReservedSeating(config);
    } else {
        container.innerHTML = '<div class="no-seating">–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–µ—Å—Ç –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞</div>';
    }
}

// –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤–æ–±–æ–¥–Ω–æ–π —Ä–∞—Å—Å–∞–¥–∫–∏
function createFreeSeating(config) {
    const container = document.getElementById('simpleHallLayout');
    const rows = config.rows || 5;
    const seatsPerRow = config.seatsPerRow || 10;
    
    for (let row = 1; row <= rows; row++) {
        const rowDiv = document.createElement('div');
        rowDiv.className = 'simple-row';
        
        const rowLabel = document.createElement('div');
        rowLabel.className = 'row-label';
        rowLabel.textContent = row;
        rowDiv.appendChild(rowLabel);
        
        for (let seat = 1; seat <= seatsPerRow; seat++) {
            const seatDiv = document.createElement('div');
            seatDiv.className = 'simple-seat free';
            seatDiv.textContent = seat;
            seatDiv.title = `–†—è–¥ ${row}, –ú–µ—Å—Ç–æ ${seat}`;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–Ω—è—Ç–æ—Å—Ç—å
            if (isSeatTaken('main', row, seat)) {
                seatDiv.className = 'simple-seat taken';
                seatDiv.title = '–ó–∞–Ω—è—Ç–æ';
            } else {
                seatDiv.onclick = () => selectSimpleSeat('main', row, seat);
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—ã–±–æ—Ä
            if (isSeatSelected('main', row, seat)) {
                seatDiv.className = 'simple-seat selected';
            }
            
            rowDiv.appendChild(seatDiv);
        }
        
        container.appendChild(rowDiv);
    }
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å QR-–∫–æ–¥–∞–º–∏ (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏–∑ tickets.js)
function generateQRCode(ticket, container) {
  if (!window.QRCode) {
    container.innerHTML = '<div class="qr-code-placeholder">QR-–∫–æ–¥<br>–Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</div>';
    return;
  }
  
  const qrData = JSON.stringify({
    code: ticket.code,
    event: currentEvent.title,
    date: currentEvent.date,
    time: currentEvent.time,
    seat: ticket.seat,
    price: ticket.price
  });
  
  try {
    QRCode.toCanvas(container, qrData, {
      width: 100,
      height: 100,
      margin: 1,
      color: {
        dark: '#2d3748',
        light: '#ffffff'
      }
    }, function(error) {
      if (error) {
        console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR-–∫–æ–¥–∞:', error);
        container.innerHTML = '<div class="qr-code-placeholder">–û—à–∏–±–∫–∞<br>QR-–∫–æ–¥–∞</div>';
      }
    });
  } catch (error) {
    container.innerHTML = '<div class="qr-code-placeholder">QR-–∫–æ–¥<br>–Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</div>';
  }
}

// –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å –∫—É–ø–ª–µ–Ω–Ω—ã–º–∏ –±–∏–ª–µ—Ç–∞–º–∏
function showPurchaseSuccess(tickets) {
  if (!tickets || tickets.length === 0) return;
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–∫—É–ø–∫–µ
  const totalPrice = tickets.reduce((sum, ticket) => sum + (ticket.price || 0), 0);
  document.getElementById('purchasedTicketsCount').textContent = tickets.length;
  document.getElementById('purchasedTotalPrice').textContent = totalPrice;
  
  // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
//   document.getElementById('purchaseQrCodes').innerHTML = '';
//   document.getElementById('ticketCodesContainer').innerHTML = '';
  
  // –î–æ–±–∞–≤–ª—è–µ–º QR-–∫–æ–¥—ã –∏ –∫–æ–¥—ã –±–∏–ª–µ—Ç–æ–≤

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
  openPurchaseSuccessModal();
}



// –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
function openPurchaseSuccessModal() {
  document.getElementById('purchaseSuccessModal').classList.add('active');
  document.body.style.overflow = 'hidden';
}

function closePurchaseSuccessModal() {
  document.getElementById('purchaseSuccessModal').classList.remove('active');
  document.body.style.overflow = '';
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
function copyTicketCode(code) {
  navigator.clipboard.writeText(code).then(() => {
    alert(`–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ! –ö–æ–¥ ${code} —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞`);
  }).catch(err => {
    console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
  });
}

function viewQRCode(ticketCode) {
  const canvas = document.querySelector(`#purchase-qr-${ticketCode} canvas`);
  if (!canvas) return;
  
  const modal = document.createElement('div');
  modal.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.9);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    cursor: pointer;
  `;
  
  const img = new Image();
  img.src = canvas.toDataURL('image/png');
  img.style.cssText = `
    max-width: 80%;
    max-height: 70%;
    border: 15px solid white;
    border-radius: 15px;
    box-shadow: 0 15px 40px rgba(0,0,0,0.5);
  `;
  
  const codeText = document.createElement('div');
  codeText.textContent = `–ë–∏–ª–µ—Ç: ${ticketCode}`;
  codeText.style.cssText = `
    color: white;
    font-size: 1.2rem;
    margin-top: 20px;
    font-family: 'Courier New', monospace;
    background: rgba(255,255,255,0.1);
    padding: 10px 20px;
    border-radius: 20px;
  `;
  
  modal.appendChild(img);
  modal.appendChild(codeText);
  modal.onclick = () => modal.remove();
  document.body.appendChild(modal);
}

function saveAllQRCodes() {
  const canvases = document.querySelectorAll('#purchaseQrCodes canvas');
  if (canvases.length === 0) return;
  
  if (canvases.length === 1) {
    // –ï—Å–ª–∏ –æ–¥–∏–Ω QR-–∫–æ–¥, —Å–∫–∞—á–∏–≤–∞–µ–º –µ–≥–æ
    downloadQRCode(canvases[0]);
  } else {
    // –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ QR-–∫–æ–¥–æ–≤, –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º zip-–∞—Ä—Ö–∏–≤
    alert('info', '–°–∫–∞—á–∏–≤–∞–Ω–∏–µ', '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∞—Ä—Ö–∏–≤–∞ —Å QR-–∫–æ–¥–∞–º–∏...');
    
    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É —Å–æ–∑–¥–∞–Ω–∏—è zip-–∞—Ä—Ö–∏–≤–∞
    // –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã —Å–∫–∞—á–∏–≤–∞–µ–º –∫–∞–∂–¥—ã–π QR-–∫–æ–¥ –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏
    canvases.forEach((canvas, index) => {
      setTimeout(() => {
        downloadQRCode(canvas, `ticket-${index + 1}.png`);
      }, index * 300);
    });
  }
}

function downloadQRCode(canvas, filename = 'ticket.png') {
  const link = document.createElement('a');
  link.download = filename;
  link.href = canvas.toDataURL('image/png');
  link.click();
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
document.addEventListener('click', function(e) {
  const modal = document.getElementById('purchaseSuccessModal');
  if (modal && modal.classList.contains('active') && e.target === modal) {
    closePurchaseSuccessModal();
  }
});

document.addEventListener('keydown', function(e) {
  const modal = document.getElementById('purchaseSuccessModal');
  if (modal && modal.classList.contains('active') && e.key === 'Escape') {
    closePurchaseSuccessModal();
  }
});

// –°–æ–∑–¥–∞–Ω–∏–µ reserved seating
function createReservedSeating(config) {
    const container = document.getElementById('simpleHallLayout');
    
    config.sections.forEach((section, sectionIndex) => {
        // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü–∏–∏
        const sectionHeader = document.createElement('div');
        sectionHeader.className = 'section-header-simple';
        sectionHeader.innerHTML = `<h4>${section.name}</h4>`;
        container.appendChild(sectionHeader);
        
        // –ú–µ—Å—Ç–∞ —Å–µ–∫—Ü–∏–∏
        for (let row = 1; row <= section.rows; row++) {
            const rowDiv = document.createElement('div');
            rowDiv.className = 'simple-row';
            
            const rowLabel = document.createElement('div');
            rowLabel.className = 'row-label';
            rowLabel.textContent = row;
            rowDiv.appendChild(rowLabel);
            
            for (let seat = 1; seat <= section.seatsPerRow; seat++) {
                const seatDiv = document.createElement('div');
                seatDiv.className = 'simple-seat free';
                seatDiv.textContent = seat;
                seatDiv.title = `${section.name}, –†—è–¥ ${row}, –ú–µ—Å—Ç–æ ${seat}`;
                seatDiv.style.borderColor = section.color || '#3a86ff';
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–Ω—è—Ç–æ—Å—Ç—å
                if (isSeatTaken(section.name, row, seat)) {
                    seatDiv.className = 'simple-seat taken';
                    seatDiv.title = '–ó–∞–Ω—è—Ç–æ';
                } else {
                    seatDiv.onclick = () => selectSimpleSeat(section.name, row, seat);
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—ã–±–æ—Ä
                if (isSeatSelected(section.name, row, seat)) {
                    seatDiv.className = 'simple-seat selected';
                }
                
                rowDiv.appendChild(seatDiv);
            }
            
            container.appendChild(rowDiv);
        }
        
        // –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –º–µ–∂–¥—É —Å–µ–∫—Ü–∏—è–º–∏ (–∫—Ä–æ–º–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π)
        if (sectionIndex < config.sections.length - 1) {
            const divider = document.createElement('div');
            divider.className = 'section-divider';
            divider.innerHTML = '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ';
            container.appendChild(divider);
        }
    });
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ä—è–¥–∞ –∏ –º–µ—Å—Ç–∞
function getRowFromSeat(seat) {
  if (!seat) return '-';
  const match = seat.match(/–†—è–¥\s*(\d+)/i);
  return match ? match[1] : '-';
}

function getSeatNumberFromSeat(seat) {
  if (!seat) return '-';
  const match = seat.match(/–ú–µ—Å—Ç–æ\s*(\d+)/i);
  return match ? match[1] : '-';
}
function createTicketElement(ticket, index) {
  const ticketDiv = document.createElement('div');
  ticketDiv.className = 'ticket-item';
  ticketDiv.style.animationDelay = `${index * 0.05}s`;
  
  const eventDate = ticket.event?.date ? new Date(ticket.event.date).toLocaleDateString('ru-RU') : '-';
  const eventTime = ticket.event?.time || '-';
  
  ticketDiv.innerHTML = `
    <div class="ticket-qr" id="qr-${ticket.code}">
      <div class="ticket-qr-placeholder">–ó–∞–≥—Ä—É–∑–∫–∞ QR...</div>
    </div>
    
    <div class="ticket-main-info">
      <div class="ticket-header">
        <span class="ticket-code">${ticket.code || 'N/A'}</span>
        <span class="ticket-status status-${getStatusClass(ticket.status)}">
          ${ticket.status || '–ê–∫—Ç–∏–≤–µ–Ω'}
        </span>
      </div>
      
      <div class="ticket-event-info">
        <div class="ticket-event-title" title="${ticket.event?.title || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}">
          ${ticket.event?.title || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}
        </div>
        <div class="ticket-event-details">
          <span title="${eventDate}">
            <i class="fas fa-calendar"></i> ${eventDate}
          </span>
          <span title="${eventTime}">
            <i class="fas fa-clock"></i> ${eventTime}
          </span>
        </div>
      </div>
      
      <div class="ticket-details">
        <div class="ticket-detail-item">
          <span class="ticket-detail-label">–ú–µ—Å—Ç–æ</span>
          <span class="ticket-detail-value" title="${ticket.seat || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}">
            ${ticket.seat || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}
          </span>
        </div>
        
        <div class="ticket-detail-item">
          <span class="ticket-detail-label">–¶–µ–Ω–∞</span>
          <span class="ticket-detail-value">${ticket.price || 0} —Ç–≥.</span>
        </div>
        
        <div class="ticket-detail-item">
          <span class="ticket-detail-label">–†—è–¥</span>
          <span class="ticket-detail-value">${getRowFromSeat(ticket.seat)}</span>
        </div>
        
        <div class="ticket-detail-item">
          <span class="ticket-detail-label">–ú–µ—Å—Ç–æ</span>
          <span class="ticket-detail-value">${getSeatNumberFromSeat(ticket.seat)}</span>
        </div>
      </div>
      
    

      </div>
    </div>
  `;
  
  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º QR-–∫–æ–¥ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ DOM
  setTimeout(() => {
    const qrContainer = ticketDiv.querySelector(`#qr-${ticket.code}`);
    if (qrContainer) {
      generateQRCode(ticket, qrContainer);
    }
  }, 100);
  
  return ticketDiv;
}

// –ü—Ä–æ—Å—Ç–æ–π –≤—ã–±–æ—Ä –º–µ—Å—Ç–∞
function selectSimpleSeat(section, row, number) {
    console.log('–í—ã–±–æ—Ä –º–µ—Å—Ç–∞:', section, row, number);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç –≤—ã–±–æ—Ä–∞
    if (selectedSeats.length >= currentQuantity && !isSeatSelected(section, row, number)) {
        alert(`–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ ${currentQuantity} –º–µ—Å—Ç(–∞)`);
        return;
    }
    
    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –≤—ã–±–æ—Ä
    const index = selectedSeats.findIndex(s => 
        s.section === section && s.row === row && s.number === number
    );
    
    if (index > -1) {
        selectedSeats.splice(index, 1);
    } else {
        selectedSeats.push({ section, row, number });
    }
    
    // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∑–∞–ª
    initSimpleHall();
    updateSimpleSelectionInfo();
}




// –û—á–∏—Å—Ç–∫–∞ –≤—ã–±–æ—Ä–∞
function clearSimpleSelection() {
    selectedSeats = [];
    initSimpleHall();
    updateSimpleSelectionInfo();
    alert('–í—ã–±–æ—Ä –æ—á–∏—â–µ–Ω');
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–Ω—è—Ç–æ—Å—Ç–∏ –º–µ—Å—Ç–∞
function isSeatTaken(section, row, number) {
    return takenSeats.some(seat => 
        seat.section === section && 
        seat.seatRow === row && 
        seat.seatNumber === number
    );
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã–±–æ—Ä–∞ –º–µ—Å—Ç–∞
function isSeatSelected(section, row, number) {
    return selectedSeats.some(seat => 
        seat.section === section && 
        seat.row === row && 
        seat.number === number
    );
}

// –§—É–Ω–∫—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–µ—á–∞—Ç–∏
function openPrintPage() {
  // –°–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
  closePurchaseSuccessModal();
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–µ—á–∞—Ç–∏
  document.getElementById('printPage').style.display = 'block';
  
   // –ó–∞–ø–æ–ª–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏
  document.getElementById('printEventTitle').textContent = currentEvent.title;
  document.getElementById('printEventDate').textContent = 
    `${new Date(currentEvent.date).toLocaleDateString('ru-RU')} –≤ ${currentEvent.time}`;
  document.getElementById('printEventLocation').textContent = 
    `${currentEvent.venue}, ${currentEvent.city}`;
  document.getElementById('printGenerationDate').textContent = 
    new Date().toLocaleString('ru-RU');
  
  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –±–∏–ª–µ—Ç—ã –¥–ª—è –ø–µ—á–∞—Ç–∏
  generatePrintTickets(purchasedTickets);
  
}

// –§—É–Ω–∫—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–µ—á–∞—Ç–∏
function closePrintPage() {
  document.getElementById('printPage').style.display = 'none';
  currentPrintTickets = [];
}

// –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ Escape –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–µ—á–∞—Ç–∏
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape' && document.getElementById('printPage').style.display === 'block') {
    closePrintPage();
  }
});

// –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫—É–ø–ª–µ–Ω–Ω—ã—Ö –±–∏–ª–µ—Ç–æ–≤
let purchasedTickets = [];

// –û–±–Ω–æ–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é showPurchaseSuccess
function showPurchaseSuccess(tickets) {
  if (!tickets || tickets.length === 0) return;
  
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –±–∏–ª–µ—Ç—ã –¥–ª—è –ø–µ—á–∞—Ç–∏
  purchasedTickets = tickets;
  
  const totalPrice = tickets.reduce((sum, ticket) => sum + (ticket.price || 0), 0);
  document.getElementById('purchasedTicketsCount').textContent = tickets.length;
  document.getElementById('purchasedTotalPrice').textContent = totalPrice;
  
  // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
  const previewContainer = document.getElementById('ticketCodesPreview');
  previewContainer.innerHTML = '';
  
  // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–¥—ã –±–∏–ª–µ—Ç–æ–≤ –≤ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
  tickets.forEach(ticket => {
    const codeBadge = document.createElement('span');
    codeBadge.className = 'ticket-code-badge';
    codeBadge.textContent = ticket.code;
    codeBadge.title = `–ú–µ—Å—Ç–æ: ${ticket.seat || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}`;
    previewContainer.appendChild(codeBadge);
  });
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
  openPurchaseSuccessModal();
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–∏–ª–µ—Ç–æ–≤ –¥–ª—è –ø–µ—á–∞—Ç–∏
async function generatePrintTickets(tickets) {
  const container = document.getElementById('printTicketsContainer');
  container.innerHTML = '';
  
  for (const ticket of tickets) {
    const ticketElement = await createPrintTicketElement(ticket);
    container.appendChild(ticketElement);
  }
}

// –°–æ–∑–¥–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –±–∏–ª–µ—Ç–∞ –¥–ª—è –ø–µ—á–∞—Ç–∏
async function createPrintTicketElement(ticket) {
  const ticketDiv = document.createElement('div');
  ticketDiv.className = 'print-ticket';
  
  const eventDate = ticket.event?.date ? new Date(ticket.event.date).toLocaleDateString('ru-RU') : '-';
  
  ticketDiv.innerHTML = `
    <div class="print-ticket-header">
      <span class="print-ticket-code">${ticket.code || 'N/A'}</span>
      <span class="print-ticket-status status-active">–ê–∫—Ç–∏–≤–µ–Ω</span>
    </div>
    
    <div class="print-ticket-info">
      <div class="print-ticket-info-item">
        <span class="print-ticket-info-label">–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ:</span>
        <span class="print-ticket-info-value">${ticket.event?.title || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</span>
      </div>
      
      <div class="print-ticket-info-item">
        <span class="print-ticket-info-label">–î–∞—Ç–∞:</span>
        <span class="print-ticket-info-value">${eventDate}</span>
      </div>
      
      <div class="print-ticket-info-item">
        <span class="print-ticket-info-label">–í—Ä–µ–º—è:</span>
        <span class="print-ticket-info-value">${ticket.event?.time || '-'}</span>
      </div>
      
      <div class="print-ticket-info-item">
        <span class="print-ticket-info-label">–ú–µ—Å—Ç–æ:</span>
        <span class="print-ticket-info-value">${ticket.seat || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</span>
      </div>
      
      <div class="print-ticket-info-item">
        <span class="print-ticket-info-label">–¶–µ–Ω–∞:</span>
        <span class="print-ticket-info-value">${ticket.price || 0} —Ç–≥.</span>
      </div>
      
      <div class="print-ticket-info-item">
        <span class="print-ticket-info-label">–ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è:</span>
        <span class="print-ticket-info-value">${ticket.event?.venue || '-'}, ${ticket.event?.city || '-'}</span>
      </div>
    </div>
    
    <div class="print-ticket-qr" id="print-qr-${ticket.code}">
      <div class="qr-loading">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–∞...</div>
    </div>
    
    <div class="print-ticket-footer">
      –ü—Ä–µ–¥—ä—è–≤–∏—Ç–µ —ç—Ç–æ—Ç –±–∏–ª–µ—Ç –Ω–∞ –≤—Ö–æ–¥–µ. –ë–∏–ª–µ—Ç –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø—Ä–µ–¥—ä—è–≤–ª–µ–Ω–∏–∏ QR-–∫–æ–¥–∞.
    </div>
  `;
  
  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º QR-–∫–æ–¥ –¥–ª—è –ø–µ—á–∞—Ç–∏
  await generateQRForPrint(ticket, ticketDiv.querySelector('.print-ticket-qr'));
  
  return ticketDiv;
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–∞ –¥–ª—è –ø–µ—á–∞—Ç–∏
async function generateQRForPrint(ticket, container) {
  try {
    if (!window.QRCode) {
      // –ï—Å–ª–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–¥ —Ç–µ–∫—Å—Ç–æ–º
      container.innerHTML = `
        <div style="text-align: center; padding: 10px;">
          <div style="font-family: monospace; font-size: 10px; margin-bottom: 5px;">
            –ö–æ–¥ –±–∏–ª–µ—Ç–∞:
          </div>
          <div style="font-family: monospace; font-weight: bold; font-size: 14px;">
            ${ticket.code}
          </div>
        </div>
      `;
      return;
    }
    
    const qrData = JSON.stringify({
      code: ticket.code,
      event: currentEvent.title,
      date: currentEvent.date,
      time: currentEvent.time,
      seat: ticket.seat,
      price: ticket.price
    });
    
    QRCode.toCanvas(container, qrData, {
      width: 120,
      height: 120,
      margin: 1,
      color: {
        dark: '#000000',
        light: '#ffffff'
      }
    });
    
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ QR-–∫–æ–¥–∞ –¥–ª—è –ø–µ—á–∞—Ç–∏:', error);
    container.innerHTML = `
      <div style="text-align: center; padding: 10px;">
        <div style="font-family: monospace; font-size: 12px;">
          ${ticket.code}
        </div>
      </div>
    `;
  }
}

// –§—É–Ω–∫—Ü–∏—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö –∫–æ–¥–æ–≤ –±–∏–ª–µ—Ç–æ–≤
function copyAllTicketCodes() {
  const codes = purchasedTickets.map(t => t.code).join('\n');
  
  navigator.clipboard.writeText(codes).then(() => {
    alert('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ! –í—Å–µ –∫–æ–¥—ã –±–∏–ª–µ—Ç–æ–≤ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞');
  }).catch(err => {
    console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', err);
    alert('–û—à–∏–±–∫–∞! –ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥—ã');
  });
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–µ—á–∞—Ç–∏
function closePrintPage() {
  document.getElementById('printPage').style.display = 'none';
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–µ—á–∞—Ç–∏
function addPrintPageBackButton() {
  const printPage = document.getElementById('printPage');
  if (!printPage) return;
  
  const backButton = document.createElement('button');
  backButton.innerHTML = '<i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥';
  backButton.className = 'btn-secondary no-print';
  backButton.style.cssText = `
    position: fixed;
    top: 20px;
    left: 20px;
    z-index: 1000;
  `;
  backButton.onclick = closePrintPage;
  
  printPage.appendChild(backButton);
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', function() {
  addPrintPageBackButton();
});

// –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–∏—Ö –±–∏–ª–µ—Ç–æ–≤
let currentPrintTickets = [];
// –§—É–Ω–∫—Ü–∏—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∫–∞–∫ PNG


// –§—É–Ω–∫—Ü–∏—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∫–∞–∫ PDF —Å —Ñ–æ—Ä–º–∞—Ç–æ–º –ê4
async function downloadAsPDF() {
  try {
    showLoading('–ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF...');
    
    const tickets = document.querySelectorAll('.print-ticket');
const canvasPromises = Array.from(tickets).map(async (ticketElement, index) => {
  const canvas = await html2canvas(ticketElement);
  const ticketObj = currentPrintTickets[index];
  const code = ticketObj && ticketObj.code ? ticketObj.code : `unknown-${index+1}`;
  return {
    canvas,
    filename: `–±–∏–ª–µ—Ç-${code}.png`
  };
});
    
    if (tickets.length === 0) {
      alert('–û—à–∏–±–∫–∞! –ù–µ—Ç –±–∏–ª–µ—Ç–æ–≤ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è');
      return;
    }
    
    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π PDF –¥–æ–∫—É–º–µ–Ω—Ç
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({
      orientation: 'portrait',
      unit: 'mm',
      format: 'a4'
    });
    
    // –†–∞–∑–º–µ—Ä—ã —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ê4 –≤ –º–º
    const pageWidth = doc.internal.pageSize.getWidth();
    const pageHeight = doc.internal.pageSize.getHeight();
    const margin = 15; // –û—Ç—Å—Ç—É–ø—ã —Å–æ –≤—Å–µ—Ö —Å—Ç–æ—Ä–æ–Ω
    
    // –î–æ—Å—Ç—É–ø–Ω–∞—è –æ–±–ª–∞—Å—Ç—å –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
    const contentWidth = pageWidth - margin * 2;
    const contentHeight = pageHeight - margin * 2;
    
    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–∞–∂–¥—ã–π –±–∏–ª–µ—Ç –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ê4
    for (let i = 0; i < tickets.length; i++) {
      if (i > 0) {
        doc.addPage(); // –ù–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –±–∏–ª–µ—Ç–∞
      }
      
      const ticketElement = tickets[i];
      const canvas = await html2canvas(ticketElement, {
        scale: 2, // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–∞—á–µ—Å—Ç–≤–æ
        useCORS: true,
        logging: false
      });
      
      const imgData = canvas.toDataURL('image/png', 1.0);
      
      // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–ø–æ—Ä—Ü–∏–π
      const imgRatio = canvas.width / canvas.height;
      let imgWidth = contentWidth;
      let imgHeight = contentWidth / imgRatio;
      
      // –ï—Å–ª–∏ –≤—ã—Å–æ—Ç–∞ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∞—è, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –ø–æ –≤—ã—Å–æ—Ç–µ
      if (imgHeight > contentHeight) {
        imgHeight = contentHeight;
        imgWidth = contentHeight * imgRatio;
      }
      
      // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
      const x = margin + (contentWidth - imgWidth) / 2;
      const y = margin + (contentHeight - imgHeight) / 2;
      
      // –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ PDF
      doc.addImage(imgData, 'PNG', x, y, imgWidth, imgHeight);
      
      // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
      if (tickets.length > 1) {
        doc.setFontSize(10);
        doc.setFont('helvetica', 'normal');
        doc.text(`–ë–∏–ª–µ—Ç ${i + 1} –∏–∑ ${tickets.length}`, pageWidth / 2, pageHeight - 10, { align: 'center' });
      }
    }
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º PDF
    doc.save('–±–∏–ª–µ—Ç—ã.pdf');
    
    alert('–£—Å–ø–µ—à–Ω–æ! –ë–∏–ª–µ—Ç—ã —Å–∫–∞—á–∞–Ω—ã –∫–∞–∫ PDF');
    
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ PDF:', error);
    alert('–û—à–∏–±–∫–∞! –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å PDF —Ñ–∞–π–ª');
  } finally {
    hideLoading();
  }
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–æ–≤
function loadScript(src) {
  return new Promise((resolve, reject) => {
    if (document.querySelector(`script[src="${src}"]`)) {
      resolve();
      return;
    }
    
    const script = document.createElement('script');
    script.src = src;
    script.onload = resolve;
    script.onerror = reject;
    document.head.appendChild(script);
  });
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
function showLoading(message = '–ó–∞–≥—Ä—É–∑–∫–∞...') {
  // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –Ω–∞—Ö–æ–¥–∏–º —ç–ª–µ–º–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏
  let loadingElement = document.getElementById('loadingOverlay');
  
  if (!loadingElement) {
    loadingElement = document.createElement('div');
    loadingElement.id = 'loadingOverlay';
    loadingElement.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10002;
      color: white;
      font-size: 18px;
    `;
    document.body.appendChild(loadingElement);
  }
  
  loadingElement.innerHTML = `
    <div style="text-align: center;">
      <i class="fas fa-spinner fa-spin" style="font-size: 40px; margin-bottom: 15px;"></i>
      <div>${message}</div>
    </div>
  `;
  
  loadingElement.style.display = 'flex';
}



const canvasPromises = Array.from(tickets).map(async (ticketElement, index) => {
  const canvas = await html2canvas(ticketElement);
  const ticketObj = currentPrintTickets[index];
  const code = ticketObj && ticketObj.code ? ticketObj.code : `unknown-${index+1}`;
  return {
    canvas,
    filename: `–±–∏–ª–µ—Ç-${code}.png`
  };
});

// –§—É–Ω–∫—Ü–∏—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ PDF
async function previewPDF() {
  try {
    showLoading('–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞...');
    
    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ
    // –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PDF.js –¥–ª—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
    
    // –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ - —Å–∫–∞—á–∏–≤–∞–µ–º –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –æ—Ç–∫—Ä—ã—Ç—å
    await downloadAsPDF();
    
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞:', error);
    alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä!');
  } finally {
    hideLoading();
  }
}

// –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
function addPreviewButton() {
  const controls = document.querySelector('.print-controls');
  if (controls) {
    const previewBtn = document.createElement('button');
    previewBtn.className = 'btn-secondary';
    previewBtn.innerHTML = '<i class="fas fa-eye"></i> –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä';
    previewBtn.onclick = previewPDF;
    controls.appendChild(previewBtn);
  }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', function() {
  addPreviewButton();
});




    </script>
    <script src="/js/tickets.js"></script>
</body>
</html>